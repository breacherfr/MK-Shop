<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MK SHOP - SUPREME V70 FULL</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        mkBlue: '#00d2ff', mkRed: '#ff4b5c', mkPurple: '#a363ff',
                        mkYellow: '#fbbf24', mkGreen: '#22c55e', mkAdmin: '#ff00ff',
                        mkDark: '#030303', mkCard: '#0a0a0c'
                    },
                    borderRadius: { '4xl': '2rem', '5xl': '3.5rem', '6xl': '5rem' },
                    animation: { 'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>

    <style>
        /* BASE STYLE CUSTOM */
        body { 
            font-family: 'Montserrat', sans-serif; 
            background-color: #030303; 
            color: #ffffff; 
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .glass { 
            backdrop-filter: blur(30px); 
            background: rgba(10, 10, 12, 0.96); 
            border: 1px solid rgba(255, 255, 255, 0.04); 
        }

        .light { background-color: #f4f7fa; color: #121212; }
        .light .glass { background: rgba(255, 255, 255, 0.9); border: 1px solid rgba(0, 0, 0, 0.05); }

        /* ANIMATIONS */
        @keyframes slideIn { 
            from { transform: translateY(20px); opacity: 0; } 
            to { transform: translateY(0); opacity: 1; } 
        }
        .animate-view { animation: slideIn 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); }

        @keyframes coinFlip {
            0% { transform: rotateY(0); }
            100% { transform: rotateY(1800deg); }
        }
        .coin-anim { animation: coinFlip 1.2s cubic-bezier(0.4, 0, 0.2, 1); }

        /* SCROLLBARS */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #00d2ff; border-radius: 10px; }

        /* TOAST SYSTEM */
        .toast {
            position: fixed; top: 25px; right: 25px; z-index: 10000;
            padding: 16px 32px; border-radius: 20px;
            background: #0a0a0c; border-left: 6px solid #00d2ff;
            font-weight: 800; font-size: 13px; text-transform: uppercase;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            pointer-events: none;
        }

        /* CHAT FLOATING WINDOW */
        #mini-chat {
            position: fixed; bottom: 30px; right: 30px;
            width: 380px; height: 550px; z-index: 5000;
            display: none; flex-direction: column;
            border-radius: 3rem; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.6);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .gradient-text {
            background: linear-gradient(90deg, #00d2ff, #a363ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="dark">

    <nav class="glass sticky top-0 z-[1000] px-8 py-6 flex justify-between items-center border-b border-white/5">
        <div class="flex items-center gap-12">
            <div class="flex items-center gap-4 cursor-pointer group" onclick="showSection('shop')">
                <div class="w-14 h-14 bg-mkBlue rounded-2xl flex items-center justify-center font-black text-black text-xl shadow-xl shadow-mkBlue/20 group-hover:scale-110 transition">MK</div>
                <div>
                    <h1 class="font-black text-2xl italic tracking-tighter leading-none">MK SHOP</h1>
                    <span class="text-[9px] font-bold text-mkBlue uppercase tracking-[0.3em] opacity-80">Supreme Edition V70</span>
                </div>
            </div>
            
            <div class="hidden xl:flex gap-10">
                <button onclick="showSection('shop')" class="text-[11px] font-black uppercase tracking-widest hover:text-mkBlue transition relative group">
                    March√©
                    <span class="absolute -bottom-2 left-0 w-0 h-0.5 bg-mkBlue transition-all group-hover:w-full"></span>
                </button>
                <button onclick="showSection('games')" class="text-[11px] font-black uppercase tracking-widest hover:text-mkBlue transition relative group">
                    Jeux & Casino
                    <span class="absolute -bottom-2 left-0 w-0 h-0.5 bg-mkBlue transition-all group-hover:w-full"></span>
                </button>
                <button onclick="showSection('leaderboard')" class="text-[11px] font-black uppercase tracking-widest hover:text-mkBlue transition relative group">
                    Classement
                    <span class="absolute -bottom-2 left-0 w-0 h-0.5 bg-mkBlue transition-all group-hover:w-full"></span>
                </button>
                <button onclick="showSection('profile')" class="text-[11px] font-black uppercase tracking-widest hover:text-mkBlue transition relative group">
                    Mon Espace
                    <span class="absolute -bottom-2 left-0 w-0 h-0.5 bg-mkBlue transition-all group-hover:w-full"></span>
                </button>
                <button id="nav-admin" onclick="showSection('admin')" class="hidden text-[11px] font-black uppercase text-mkAdmin border-2 border-mkAdmin/20 px-4 py-2 rounded-xl hover:bg-mkAdmin/10 transition">Console</button>
            </div>
        </div>

        <div class="flex items-center gap-6">
            <div class="flex bg-mkDark rounded-2xl p-1.5 border border-white/10 shadow-inner">
                <button id="m-cash" onclick="setMode('cash')" class="px-6 py-2.5 rounded-xl text-[10px] font-black bg-mkGreen text-black transition-all shadow-lg">CASH</button>
                <button id="m-xp" onclick="setMode('xp')" class="px-6 py-2.5 rounded-xl text-[10px] font-black opacity-30 transition-all text-white">EXP</button>
            </div>
            
            <div class="bg-mkDark/50 px-6 py-3 rounded-2xl border border-white/5 min-w-[140px] text-center shadow-2xl">
                <span id="val-display" class="font-black text-lg text-mkGreen tracking-tighter">0.00‚Ç¨</span>
            </div>

            <div id="auth-zone">
                <button onclick="openModal('modal-auth')" class="bg-white text-black px-7 py-3.5 rounded-2xl font-black text-[10px] uppercase shadow-xl hover:bg-mkBlue transition-all active:scale-95">S'identifier</button>
            </div>

            <div id="user-zone" class="hidden flex items-center gap-4">
                <div class="relative">
                    <img id="u-pfp" src="" class="w-12 h-12 rounded-2xl border-2 border-mkBlue object-cover shadow-lg shadow-mkBlue/10">
                    <div class="absolute -top-2 -right-2 bg-mkRed w-5 h-5 rounded-full border-2 border-mkDark flex items-center justify-center text-[10px] font-black">!</div>
                </div>
                <button onclick="logout()" class="w-10 h-10 glass rounded-xl text-mkRed font-black flex items-center justify-center hover:bg-mkRed/10 transition">‚úï</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-8 py-16 lg:pr-[440px]">

        <section id="s-shop" class="animate-view space-y-16">
            <div class="flex flex-col gap-4">
                <h2 class="text-7xl font-black italic uppercase leading-none tracking-tighter">MK <span class="gradient-text">MARKET</span></h2>
                <p class="text-xs font-bold uppercase tracking-[0.5em] opacity-30">Plateforme de vente s√©curis√©e</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="glass p-12 rounded-6xl border-t-8 border-mkBlue hover:translate-y-[-10px] transition-all duration-500 group">
                    <div class="w-20 h-20 bg-mkBlue/10 rounded-3xl flex items-center justify-center text-4xl mb-8 group-hover:scale-110 transition">üéÆ</div>
                    <h3 class="text-3xl font-black uppercase italic">Roblox High-End</h3>
                    <p class="text-[12px] opacity-40 mt-4 leading-relaxed font-medium">Acc√®s √† des comptes certifi√©s avec skins Limited, Korblox, Headless et progression maximale.</p>
                    <div class="mt-10 flex items-center justify-between">
                        <span class="text-2xl font-black">√Ä partir de 15‚Ç¨</span>
                        <button onclick="openTicket('Achat Roblox')" class="bg-white text-black px-8 py-4 rounded-2xl font-black text-[11px] uppercase hover:bg-mkBlue transition shadow-lg">Commander</button>
                    </div>
                </div>

                <div class="glass p-12 rounded-6xl border-t-8 border-mkPurple hover:translate-y-[-10px] transition-all duration-500 group">
                    <div class="w-20 h-20 bg-mkPurple/10 rounded-3xl flex items-center justify-center text-4xl mb-8 group-hover:scale-110 transition">‚ö°</div>
                    <h3 class="text-3xl font-black uppercase italic">Private Cheats</h3>
                    <p class="text-[12px] opacity-40 mt-4 leading-relaxed font-medium">Menus d'injection ind√©tectables avec mises √† jour quotidiennes pour rester au sommet du classement.</p>
                    <div class="mt-10 flex items-center justify-between">
                        <span class="text-2xl font-black">Licence 24h/7j</span>
                        <button onclick="openTicket('Achat Cheat')" class="bg-mkPurple text-white px-8 py-4 rounded-2xl font-black text-[11px] uppercase shadow-xl shadow-mkPurple/20">Voir Catalogue</button>
                    </div>
                </div>

                <div class="md:col-span-2 glass p-16 rounded-[4rem] relative overflow-hidden flex flex-col md:flex-row items-center justify-between border-2 border-white/5">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-mkBlue/10 blur-[100px] rounded-full"></div>
                    <div class="relative z-10 text-center md:text-left">
                        <span class="bg-mkYellow text-black px-4 py-1 rounded-full text-[10px] font-black uppercase mb-4 inline-block">Offre Limit√©e</span>
                        <h3 class="text-5xl font-black uppercase italic leading-tight">Pack Full <br><span class="text-mkBlue">Access VIP</span></h3>
                        <p class="text-[13px] opacity-40 mt-4 font-bold uppercase tracking-widest">Tout le catalogue √† -50%</p>
                    </div>
                    <button onclick="openTicket('Promo Pack')" class="mt-10 md:mt-0 relative z-10 bg-white text-black h-24 w-24 rounded-full font-black text-[10px] uppercase hover:scale-110 transition shadow-2xl">Acheter</button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 pt-10">
                <div class="glass p-10 rounded-5xl text-center border-b-4 border-mkGreen">
                    <span class="text-3xl mb-4 block">üçø</span>
                    <h4 class="font-black uppercase text-sm italic">Netflix / Spotify</h4>
                    <p class="text-[10px] opacity-30 mt-2">Comptes premium √† vie.</p>
                </div>
                <div class="glass p-10 rounded-5xl text-center border-b-4 border-mkYellow">
                    <span class="text-3xl mb-4 block">üõ°Ô∏è</span>
                    <h4 class="font-black uppercase text-sm italic">VPN Priv√©</h4>
                    <p class="text-[10px] opacity-30 mt-2">Navigation 100% anonyme.</p>
                </div>
                <div class="glass p-10 rounded-5xl text-center border-b-4 border-mkRed">
                    <span class="text-3xl mb-4 block">üí∞</span>
                    <h4 class="font-black uppercase text-sm italic">M√©thodes Money</h4>
                    <p class="text-[10px] opacity-30 mt-2">Apprenez √† g√©n√©rer du cash.</p>
                </div>
            </div>
        </section>

        <section id="s-games" class="hidden animate-view space-y-16">
            <h2 class="text-7xl font-black italic uppercase leading-none tracking-tighter">MK <span class="text-mkRed">CASINO</span></h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="glass p-12 rounded-6xl text-center relative overflow-hidden group">
                    <div class="absolute inset-0 bg-mkBlue/5 opacity-0 group-hover:opacity-100 transition"></div>
                    <div id="coin-res" class="text-9xl mb-12 drop-shadow-2xl transition-all duration-500">ü™ô</div>
                    <div class="space-y-6 relative z-10">
                        <div class="flex flex-col items-center">
                            <label class="text-[10px] font-black uppercase opacity-30 mb-2">Mise en Cash</label>
                            <input id="bet-coin" type="number" value="10" class="bg-mkDark/80 p-5 rounded-2xl w-40 text-center font-black text-2xl outline-none border border-white/10 focus:border-mkBlue transition">
                        </div>
                        <div class="flex gap-4">
                            <button onclick="playGame('coin', 'pile')" class="flex-1 bg-mkBlue text-black py-5 rounded-2xl font-black text-xs uppercase shadow-xl hover:scale-105 transition">Miser Pile</button>
                            <button onclick="playGame('coin', 'face')" class="flex-1 bg-white text-black py-5 rounded-2xl font-black text-xs uppercase shadow-xl hover:scale-105 transition">Miser Face</button>
                        </div>
                    </div>
                </div>

                <div class="glass p-12 rounded-6xl text-center border-t-4 border-mkPurple">
                    <div class="flex justify-center gap-4 text-7xl mb-12 bg-mkDark/50 p-10 rounded-4xl border border-white/5 shadow-inner">
                        <span id="sl1" class="drop-shadow-lg">üíé</span>
                        <span id="sl2" class="drop-shadow-lg">üíé</span>
                        <span id="sl3" class="drop-shadow-lg">üíé</span>
                    </div>
                    <div class="flex flex-col items-center mb-10">
                        <label class="text-[10px] font-black uppercase opacity-30 mb-2">Mise en Cash</label>
                        <input id="bet-slots" type="number" value="10" class="bg-mkDark/80 p-5 rounded-2xl w-40 text-center font-black text-2xl outline-none border border-white/10">
                    </div>
                    <button onclick="playGame('slots')" class="w-full bg-mkPurple text-white py-6 rounded-3xl font-black text-xs uppercase shadow-2xl shadow-mkPurple/30 hover:bg-mkPurple/80 transition">Lancer le Tirage (Win x15)</button>
                </div>

                <div class="glass p-12 rounded-6xl text-center">
                    <div id="dice-res" class="text-9xl mb-12 text-mkYellow">üé≤</div>
                    <input id="bet-dice" type="number" value="10" class="bg-mkDark/80 p-5 rounded-2xl w-40 text-center font-black text-2xl outline-none border border-white/10 mb-8">
                    <button onclick="playGame('dice')" class="w-full bg-mkYellow text-black py-6 rounded-3xl font-black text-xs uppercase">Lancer D√©s (Objectif 4+)</button>
                </div>

                <div class="glass p-12 rounded-6xl text-center">
                    <h3 class="text-3xl font-black uppercase italic mb-8">Chifoumi Royal</h3>
                    <div class="flex justify-center gap-6 mb-10">
                        <button onclick="playGame('rps', 'pierre')" class="w-20 h-20 glass rounded-3xl text-3xl hover:bg-mkBlue transition-all hover:scale-110">‚úä</button>
                        <button onclick="playGame('rps', 'feuille')" class="w-20 h-20 glass rounded-3xl text-3xl hover:bg-mkBlue transition-all hover:scale-110">‚úã</button>
                        <button onclick="playGame('rps', 'ciseaux')" class="w-20 h-20 glass rounded-3xl text-3xl hover:bg-mkBlue transition-all hover:scale-110">‚úåÔ∏è</button>
                    </div>
                    <input id="bet-rps" type="number" value="10" class="bg-mkDark/80 p-5 rounded-2xl w-40 text-center font-black text-2xl outline-none border border-white/10">
                    <p class="text-[10px] font-bold opacity-30 uppercase mt-4 tracking-[0.3em]">Multiplicateur x2.5</p>
                </div>
            </div>
        </section>

        <section id="s-profile" class="hidden animate-view max-w-2xl mx-auto space-y-12">
            <div class="glass p-5 rounded-3xl flex gap-4 border border-white/10">
                <input id="search-name" type="text" placeholder="Rechercher un pseudonyme..." class="flex-1 bg-transparent px-6 text-[11px] font-extrabold outline-none uppercase tracking-widest text-white">
                <button onclick="findMember()" class="bg-mkBlue text-black px-8 py-4 rounded-2xl font-black text-[10px] uppercase hover:bg-white transition-all">Rechercher</button>
            </div>

            <div id="p-card" class="glass p-16 rounded-[5rem] text-center border-b-[16px] border-mkBlue relative overflow-hidden">
                <div class="absolute -top-10 -left-10 w-40 h-40 bg-mkBlue/10 blur-[80px] rounded-full"></div>
                
                <img id="p-avatar" src="" class="w-44 h-44 rounded-[4rem] mx-auto object-cover border-8 border-mkDark shadow-2xl mb-10">
                <h3 id="p-username" class="text-5xl font-black italic uppercase tracking-tighter">Utilisateur</h3>
                <div id="p-rank" class="text-mkBlue font-black text-[10px] uppercase tracking-[0.4em] mt-2">Membre Certifi√©</div>
                
                <div class="grid grid-cols-2 gap-6 mt-12">
                    <div class="bg-mkDark/60 p-10 rounded-[3rem] border border-white/5">
                        <p class="text-[10px] opacity-30 font-black uppercase mb-2 tracking-widest">Solde Cash</p>
                        <p id="p-val-cash" class="text-3xl font-black text-mkGreen">0.00‚Ç¨</p>
                    </div>
                    <div class="bg-mkDark/60 p-10 rounded-[3rem] border border-white/5">
                        <p class="text-[10px] opacity-30 font-black uppercase mb-2 tracking-widest">Exp√©rience</p>
                        <p id="p-val-xp" class="text-3xl font-black text-mkYellow">0 XP</p>
                    </div>
                </div>

                <div id="p-controls" class="mt-12 pt-12 border-t border-white/5 space-y-8 text-left hidden">
                    <div class="flex flex-col gap-4">
                        <label class="text-[10px] font-black uppercase opacity-40 ml-4">URL Image de Profil</label>
                        <div class="flex gap-4">
                            <input id="new-pfp-url" type="text" placeholder="https://image-link.com/photo.png" class="flex-1 bg-mkDark/80 p-5 rounded-2xl text-[11px] font-bold outline-none border border-white/10 focus:border-mkBlue transition text-white">
                            <button onclick="updatePfp()" class="bg-white text-black px-8 rounded-2xl font-black text-[10px] uppercase hover:bg-mkBlue transition">Maj</button>
                        </div>
                    </div>
                    <div class="flex flex-col gap-4">
                        <label class="text-[10px] font-black uppercase opacity-40 ml-4">Code Promo / Cadeau</label>
                        <div class="flex gap-4">
                            <input id="promo-code" type="text" placeholder="XXXX-XXXX-XXXX" class="flex-1 bg-mkDark/80 p-5 rounded-2xl text-[11px] font-black uppercase outline-none border border-white/10 focus:border-mkPurple transition text-white">
                            <button onclick="usePromo()" class="bg-mkPurple text-white px-8 rounded-2xl font-black text-[10px] uppercase shadow-lg shadow-mkPurple/20">Activer</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="s-leaderboard" class="hidden animate-view space-y-12">
            <div class="text-center space-y-4">
                <h2 class="text-6xl font-black italic uppercase tracking-tighter">Top <span class="text-mkGreen">Fortune</span></h2>
                <p class="text-[10px] font-bold opacity-30 uppercase tracking-[0.5em]">Les 10 membres les plus riches du shop</p>
            </div>
            
            <div id="leader-container" class="glass rounded-[4rem] overflow-hidden border border-white/5 shadow-2xl">
                </div>
        </section>

        <section id="s-admin" class="hidden animate-view space-y-16">
            <div class="flex justify-between items-end border-b-4 border-mkAdmin pb-6">
                <h2 class="text-6xl font-black text-mkAdmin italic uppercase tracking-tighter">Console</h2>
                <div class="text-right">
                    <p class="text-[10px] font-black uppercase opacity-40">Statut Syst√®me</p>
                    <p class="text-mkGreen font-black text-xs">OP√âRATIONNEL</p>
                </div>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-2 gap-12">
                <div class="space-y-8">
                    <h3 class="text-xs font-black uppercase text-mkRed tracking-[0.4em] ml-4">Tickets en attente</h3>
                    <div id="adm-tickets" class="space-y-4">
                        </div>
                </div>

                <div class="space-y-8">
                    <h3 class="text-xs font-black uppercase text-mkBlue tracking-[0.4em] ml-4">Base de donn√©es Membres</h3>
                    <div id="adm-users" class="space-y-4 max-h-[700px] overflow-y-auto pr-4 no-scrollbar">
                        </div>
                </div>
            </div>
        </section>

    </main>

    <button onclick="toggleChat()" class="fixed bottom-10 right-10 w-24 h-24 bg-mkBlue rounded-[2.5rem] shadow-2xl shadow-mkBlue/30 flex items-center justify-center text-4xl z-[6000] hover:scale-110 active:scale-95 transition-all animate-pulse-slow">üí¨</button>
    
    <div id="mini-chat" class="glass">
        <div class="p-8 bg-white/5 border-b border-white/5 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-3 h-3 bg-mkGreen rounded-full animate-pulse shadow-[0_0_10px_#22c55e]"></div>
                <div>
                    <span class="text-[12px] font-black uppercase tracking-widest text-white">Chat Global</span>
                    <p class="text-[8px] font-bold opacity-30 uppercase">Saloon en ligne</p>
                </div>
            </div>
            <button onclick="toggleChat()" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 hover:bg-mkRed hover:text-white transition text-white/20">‚úï</button>
        </div>
        
        <div id="chat-flow" class="flex-1 p-8 overflow-y-auto space-y-8 no-scrollbar scroll-smooth">
            </div>
        
        <div class="p-8 border-t border-white/5 bg-mkDark/30">
            <div class="bg-mkDark/80 rounded-3xl p-3 flex gap-4 border border-white/10 focus-within:border-mkBlue/50 transition-all shadow-2xl">
                <input id="chat-input" type="text" placeholder="Entrez votre message..." class="bg-transparent flex-1 outline-none px-4 text-[11px] font-extrabold text-white">
                <button onclick="sendChatMessage()" class="w-14 h-14 bg-mkBlue text-black rounded-2xl font-black text-xl shadow-lg shadow-mkBlue/20 hover:bg-white transition-all active:scale-90">></button>
            </div>
        </div>
    </div>

    <div id="modal-auth" class="fixed inset-0 z-[9999] bg-black/95 backdrop-blur-md flex items-center justify-center p-6 hidden">
        <div class="glass w-full max-w-md rounded-[4rem] p-16 text-center border-t-8 border-mkBlue relative overflow-hidden">
            <div class="absolute -top-20 -right-20 w-64 h-64 bg-mkBlue/10 blur-[100px] rounded-full"></div>
            
            <h3 class="text-5xl font-black italic uppercase tracking-tighter leading-none mb-4">Acc√®s <br><span class="text-mkBlue">Client</span></h3>
            <p class="text-[10px] font-bold opacity-30 uppercase tracking-[0.5em] mb-12">Portail d'identification MK</p>
            
            <div class="space-y-5 relative z-10">
                <div class="group">
                    <input id="in-email" type="email" placeholder="ADRESSE EMAIL" class="w-full bg-mkDark/60 p-6 rounded-2xl outline-none text-[12px] font-extrabold border border-white/10 focus:border-mkBlue transition text-white uppercase tracking-widest">
                </div>
                <div class="group">
                    <input id="in-user" type="text" placeholder="PSEUDONYME" class="w-full bg-mkDark/60 p-6 rounded-2xl outline-none text-[12px] font-extrabold border border-white/10 focus:border-mkBlue transition text-white uppercase tracking-widest">
                </div>
                <div class="group">
                    <input id="in-pass" type="password" placeholder="MOT DE PASSE" class="w-full bg-mkDark/60 p-6 rounded-2xl outline-none text-[12px] font-extrabold border border-white/10 focus:border-mkBlue transition text-white uppercase tracking-widest">
                </div>
                
                <button onclick="processAuth()" class="w-full bg-mkBlue text-black py-6 rounded-3xl font-black text-xs uppercase mt-6 shadow-2xl shadow-mkBlue/30 hover:bg-white hover:scale-105 transition-all">Confirmer l'acc√®s</button>
                <button onclick="closeModal('modal-auth')" class="text-[9px] font-black opacity-30 uppercase mt-6 hover:opacity-100 transition tracking-[0.3em]">Retour au shop</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION SUPABASE
        const SB_URL = "https://eeiuxfcgysrarctokuyg.supabase.co";
        const SB_KEY = "sb_publishable_0fuup_i-vDgKHozqpz706A_4tGWghxn";
        const sb = supabase.createClient(SB_URL, SB_KEY);

        let user = null;
        let currentMode = 'cash';
        let chatLoop = null;
        let lastMsgCount = 0;

        // --- SYST√àME NOTIFICATIONS ---
        function toast(msg, color='mkBlue') {
            const el = document.createElement('div');
            el.className = 'toast animate-view';
            el.style.borderLeftColor = `var(--${color})`;
            el.innerText = msg;
            document.body.appendChild(el);
            setTimeout(() => {
                el.style.opacity = '0';
                el.style.transform = 'translateX(50px)';
                setTimeout(() => el.remove(), 500);
            }, 3000);
        }

        // --- GESTION NAVIGATION ---
        function showSection(id) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById('s-' + id).classList.remove('hidden');
            
            // Rechargement des donn√©es sp√©cifiques
            if(id === 'leaderboard') loadLeaderboard();
            if(id === 'admin') loadAdminPanel();
            if(id === 'profile') renderProfile(user);
            
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function setMode(m) {
            currentMode = m;
            document.getElementById('m-cash').className = m === 'cash' ? 'px-6 py-2.5 rounded-xl text-[10px] font-black bg-mkGreen text-black transition shadow-lg' : 'px-6 py-2.5 rounded-xl text-[10px] font-black opacity-30 transition text-white';
            document.getElementById('m-xp').className = m === 'xp' ? 'px-6 py-2.5 rounded-xl text-[10px] font-black bg-mkYellow text-black transition shadow-lg' : 'px-6 py-2.5 rounded-xl text-[10px] font-black opacity-30 transition text-white';
            syncDisplay();
        }

        // --- AUTHENTIFICATION ---
        async function processAuth() {
            const e = document.getElementById('in-email').value.trim();
            const u = document.getElementById('in-user').value.trim();
            const p = document.getElementById('in-pass').value.trim();
            
            if(!e || !p) return toast("Informations manquantes", "mkRed");

            let { data: prof, error } = await sb.from('profiles').select('*').eq('email', e).maybeSingle();

            if(!prof) {
                // Cr√©ation d'un nouveau profil
                const { data, error: insErr } = await sb.from('profiles').insert([{
                    email: e, username: u || "User_"+Math.floor(Math.random()*9999),
                    password: p, balance: 10, xp: 0,
                    pfp: `https://api.dicebear.com/7.x/pixel-art/svg?seed=${e}`,
                    tv_access: false, banned: false
                }]).select().single();
                
                if(insErr) return toast("Erreur Serveur", "mkRed");
                prof = data;
                toast("Compte cr√©√© ! +10‚Ç¨ offerts", "mkGreen");
            } else {
                // V√©rification connexion
                if(prof.password !== p) return toast("Mot de passe incorrect", "mkRed");
                if(prof.banned) return toast("VOTRE COMPTE EST BANNI", "mkRed");
                toast("Connexion r√©ussie");
            }

            user = prof;
            localStorage.setItem('mk_session_v70', JSON.stringify(user));
            closeModal('modal-auth');
            initApp();
        }

        function initApp() {
            if(!user) return;
            document.getElementById('auth-zone').classList.add('hidden');
            document.getElementById('user-zone').classList.remove('hidden');
            document.getElementById('u-pfp').src = user.pfp;
            
            // V√©rification Admin
            if(user.username.toLowerCase() === 'admin') {
                document.getElementById('nav-admin').classList.remove('hidden');
            }
            
            syncDisplay();
            
            // Lancement de la boucle de chat (Silent Refresh)
            if(!chatLoop) {
                loadChat(); // Premier chargement imm√©diat
                chatLoop = setInterval(loadChat, 3000);
            }
        }

        function syncDisplay() {
            if(!user) return;
            const el = document.getElementById('val-display');
            if(currentMode === 'cash') {
                el.innerText = user.balance.toFixed(2) + "‚Ç¨";
                el.className = "font-black text-lg text-mkGreen tracking-tighter";
            } else {
                el.innerText = user.xp + " XP";
                el.className = "font-black text-lg text-mkYellow tracking-tighter";
            }
        }

        // --- SYST√àME CASINO ---
        async function updateDatabase(newBalance, addXp=15) {
            const { data, error } = await sb.from('profiles').update({
                balance: newBalance,
                xp: user.xp + addXp
            }).eq('id', user.id).select().single();
            
            if(data) {
                user = data;
                syncDisplay();
                renderProfile(user);
            }
        }

        async function playGame(type, side) {
            if(!user) return toast("Identifiez-vous", "mkRed");
            const betInput = document.getElementById('bet-'+type);
            const bet = parseFloat(betInput.value);
            
            if(bet > user.balance || bet <= 0) return toast("Solde insuffisant", "mkRed");

            if(type === 'coin') {
                const coinEl = document.getElementById('coin-res');
                coinEl.classList.add('coin-anim');
                
                setTimeout(async () => {
                    coinEl.classList.remove('coin-anim');
                    const isWin = Math.random() > 0.55; // 45% de win
                    coinEl.innerText = isWin ? (side === 'pile' ? 'ü™ô' : 'üü°') : (side === 'pile' ? 'üü°' : 'ü™ô');
                    
                    const finalBalance = isWin ? user.balance + bet : user.balance - bet;
                    await updateDatabase(finalBalance, 25);
                    toast(isWin ? "F√âLICITATIONS ! GAGN√â" : "DOMMAGE... PERDU", isWin ? 'mkGreen' : 'mkRed');
                }, 1200);
            }

            if(type === 'slots') {
                const symbols = ['üíé', 'üçí', 'üçã', '‚≠ê', 'üçá', 'üî•'];
                const res = [
                    symbols[Math.floor(Math.random()*6)],
                    symbols[Math.floor(Math.random()*6)],
                    symbols[Math.floor(Math.random()*6)]
                ];
                
                document.getElementById('sl1').innerText = res[0];
                document.getElementById('sl2').innerText = res[1];
                document.getElementById('sl3').innerText = res[2];
                
                let multiplier = 0;
                if(res[0] === res[1] && res[1] === res[2]) multiplier = 15;
                else if(res[0] === res[1] || res[1] === res[2] || res[0] === res[2]) multiplier = 2;
                
                const finalBalance = (user.balance - bet) + (bet * multiplier);
                await updateDatabase(finalBalance, 40);
                
                if(multiplier > 0) toast("JACKPOT SLOTS x"+multiplier, "mkPurple");
                else toast("AUCUNE COMBINAISON", "mkRed");
            }

            if(type === 'dice') {
                const score = Math.floor(Math.random()*6) + 1;
                const faces = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
                document.getElementById('dice-res').innerText = faces[score-1];
                
                const win = score >= 4;
                const finalBalance = win ? user.balance + (bet * 0.9) : user.balance - bet;
                await updateDatabase(finalBalance, 20);
                toast(win ? "BIEN JOU√â" : "PERDU", win ? 'mkGreen' : 'mkRed');
            }

            if(type === 'rps') {
                const choices = ['pierre', 'feuille', 'ciseaux'];
                const cpu = choices[Math.floor(Math.random()*3)];
                let result = 'lose';
                
                if(side === cpu) result = 'draw';
                else if(
                    (side==='pierre' && cpu==='ciseaux') || 
                    (side==='feuille' && cpu==='pierre') || 
                    (side==='ciseaux' && cpu==='feuille')
                ) result = 'win';
                
                if(result === 'win') {
                    await updateDatabase(user.balance + (bet*1.5), 35);
                    toast("VICTOIRE VS "+cpu.toUpperCase(), "mkGreen");
                } else if(result === 'draw') {
                    toast("√âGALIT√â VS "+cpu.toUpperCase(), "mkYellow");
                } else {
                    await updateDatabase(user.balance - bet, 10);
                    toast("D√âFAITE VS "+cpu.toUpperCase(), "mkRed");
                }
            }
        }

        // --- SYST√àME CHAT (REWORKED - NO FLICKER) ---
        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if(!user || !msg) return;
            
            input.value = ""; // Clear imm√©diat
            
            const { error } = await sb.from('messages').insert([{
                username: user.username,
                content: msg,
                pfp: user.pfp,
                level: Math.floor(user.xp / 120)
            }]);
            
            if(error) {
                toast("Erreur d'envoi", "mkRed");
                input.value = msg;
            } else {
                loadChat(); // Force reload local
            }
        }

        async function loadChat() {
            const { data, error } = await sb.from('messages').select('*').order('created_at', { ascending: false }).limit(35);
            if(!data || error) return;

            // Syst√®me de v√©rification pour √©viter le clignotement
            if(data.length === lastMsgCount) return;
            lastMsgCount = data.length;

            const chatContainer = document.getElementById('chat-flow');
            chatContainer.innerHTML = data.reverse().map(m => `
                <div class="flex gap-5 items-start animate-view group">
                    <div class="relative flex-shrink-0">
                        <img src="${m.pfp}" class="w-11 h-11 rounded-2xl object-cover shadow-lg border border-white/5">
                        <div class="absolute -bottom-1 -right-1 bg-mkBlue text-black text-[6px] font-black px-1 rounded-md">L${m.level || 0}</div>
                    </div>
                    <div class="flex-1 space-y-1">
                        <div class="flex items-center gap-2">
                            <b class="text-[10px] uppercase tracking-tighter text-white/90 font-black">${m.username}</b>
                            <span class="text-[7px] opacity-20 font-bold">${new Date(m.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                        </div>
                        <div class="bg-white/5 p-4 rounded-2xl rounded-tl-none border border-white/5 group-hover:bg-white/10 transition">
                            <p class="text-[11px] text-white/70 leading-relaxed font-medium">${m.content}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // --- FONCTIONS PROFIL & ADMIN ---
        async function renderProfile(profileData) {
            if(!profileData) return;
            document.getElementById('p-avatar').src = profileData.pfp;
            document.getElementById('p-username').innerText = profileData.username;
            document.getElementById('p-val-cash').innerText = profileData.balance.toFixed(2) + "‚Ç¨";
            document.getElementById('p-val-xp').innerText = profileData.xp + " XP";
            
            // Afficher les contr√¥les si c'est le compte de l'utilisateur
            const isOwner = user && (profileData.id === user.id);
            document.getElementById('p-controls').classList.toggle('hidden', !isOwner);
        }

        async function findMember() {
            const name = document.getElementById('search-name').value.trim();
            if(!name) return;
            const { data, error } = await sb.from('profiles').select('*').eq('username', name).maybeSingle();
            if(data) renderProfile(data);
            else toast("Membre introuvable", "mkRed");
        }

        async function updatePfp() {
            const newUrl = document.getElementById('new-pfp-url').value.trim();
            if(!newUrl) return;
            const { data, error } = await sb.from('profiles').update({ pfp: newUrl }).eq('id', user.id).select().single();
            if(data) {
                user = data;
                initApp();
                renderProfile(user);
                toast("Avatar mis √† jour");
            }
        }

        async function usePromo() {
            const code = document.getElementById('promo-code').value.trim().toUpperCase();
            if(code === 'MK70' || code === 'GITHUB') {
                await updateDatabase(user.balance + 20, 100);
                toast("CODE VALIDE : +20.00‚Ç¨", "mkGreen");
            } else {
                toast("CODE INVALIDE", "mkRed");
            }
            document.getElementById('promo-code').value = "";
        }

        async function loadLeaderboard() {
            const { data } = await sb.from('profiles').select('*').order('balance', { ascending: false }).limit(10);
            document.getElementById('leader-container').innerHTML = data.map((u, i) => `
                <div class="flex justify-between items-center p-8 border-b border-white/5 hover:bg-white/5 transition group">
                    <div class="flex items-center gap-6">
                        <span class="text-3xl font-black italic ${i < 3 ? 'text-mkBlue' : 'opacity-10'}">#${i+1}</span>
                        <img src="${u.pfp}" class="w-14 h-14 rounded-2xl shadow-xl border border-white/10 group-hover:scale-110 transition">
                        <div>
                            <b class="text-sm uppercase font-black tracking-tighter">${u.username}</b>
                            <div class="flex items-center gap-2">
                                <span class="text-[8px] bg-mkYellow/10 text-mkYellow px-2 py-0.5 rounded font-black">${u.xp} XP</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="text-mkGreen font-black text-xl">${u.balance.toFixed(2)}‚Ç¨</span>
                    </div>
                </div>
            `).join('');
        }

        async function openTicket(type) {
            if(!user) return toast("Connectez-vous", "mkRed");
            const { error } = await sb.from('tickets').insert([{
                username: user.username,
                type: type,
                status: 'open',
                content: 'Demande via boutique'
            }]);
            if(!error) toast("Ticket envoy√© √† l'admin", "mkGreen");
        }

        // --- ADMIN PANEL FUNCTIONS ---
        async function loadAdminPanel() {
            const { data: tickets } = await sb.from('tickets').select('*').eq('status', 'open');
            const { data: usersList } = await sb.from('profiles').select('*').order('created_at', { ascending: false });
            
            document.getElementById('adm-tickets').innerHTML = (tickets || []).map(t => `
                <div class="glass p-6 rounded-3xl flex justify-between items-center border-l-4 border-mkRed animate-view">
                    <div>
                        <b class="text-[11px] uppercase block">${t.type}</b>
                        <span class="text-[9px] opacity-40 font-bold uppercase">Client: ${t.username}</span>
                    </div>
                    <button onclick="closeTicket('${t.id}')" class="bg-mkRed text-white px-5 py-2 rounded-xl text-[9px] font-black uppercase shadow-lg shadow-mkRed/20">Clore</button>
                </div>
            `).join('');

            document.getElementById('adm-users').innerHTML = (usersList || []).map(u => `
                <div class="glass p-6 rounded-3xl space-y-5">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-4">
                            <img src="${u.pfp}" class="w-12 h-12 rounded-xl shadow-lg">
                            <div>
                                <b class="text-[11px] uppercase">${u.username}</b>
                                <p class="text-[9px] opacity-30 font-mono">${u.password}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-mkGreen font-black text-sm">${u.balance.toFixed(2)}‚Ç¨</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="adminMod('${u.id}', 50)" class="flex-1 bg-mkGreen/10 text-mkGreen py-3 rounded-xl text-[9px] font-black">+50‚Ç¨</button>
                        <button onclick="adminMod('${u.id}', -50)" class="flex-1 bg-mkRed/10 text-mkRed py-3 rounded-xl text-[9px] font-black">-50‚Ç¨</button>
                        <button onclick="adminBan('${u.id}', ${!u.banned})" class="flex-1 bg-mkAdmin/10 text-mkAdmin py-3 rounded-xl text-[9px] font-black">${u.banned ? 'D√âBAN' : 'BAN'}</button>
                    </div>
                </div>
            `).join('');
        }

        async function adminMod(id, val) {
            const { data: curr } = await sb.from('profiles').select('balance').eq('id', id).single();
            await sb.from('profiles').update({ balance: curr.balance + val }).eq('id', id);
            loadAdminPanel();
            toast("Balance Modifi√©e");
        }

        async function adminBan(id, state) {
            await sb.from('profiles').update({ banned: state }).eq('id', id);
            loadAdminPanel();
            toast(state ? "Utilisateur Banni" : "Acc√®s R√©tabli");
        }

        async function closeTicket(id) {
            await sb.from('tickets').update({ status: 'closed' }).eq('id', id);
            loadAdminPanel();
        }

        // --- HELPERS INTERFACE ---
        function toggleChat() {
            const chat = document.getElementById('mini-chat');
            chat.style.display = (chat.style.display === 'flex') ? 'none' : 'flex';
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        
        function logout() {
            localStorage.removeItem('mk_session_v70');
            location.reload();
        }

        // --- LANCEMENT ---
        window.onload = () => {
            const savedSession = localStorage.getItem('mk_session_v70');
            if(savedSession) {
                user = JSON.parse(savedSession);
                initApp();
            }
        }
    </script>
</body>
</html>
