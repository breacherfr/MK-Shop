<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MK SHOP - FULL VERSION V53</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Montserrat', 'sans-serif'] },
                    colors: { 
                        mkBlue: '#00d2ff', mkRed: '#ff4b5c', mkPurple: '#a363ff', 
                        mkYellow: '#fbbf24', mkGreen: '#22c55e', mkAdmin: '#ff00ff'
                    }
                }
            }
        }
    </script>
    <style>
        :root { --bg-body: #050505; --text-main: #ffffff; --glass: rgba(20, 20, 25, 0.96); --border: rgba(255,255,255,0.1); }
        .light { --bg-body: #f3f4f6; --text-main: #111827; --glass: rgba(255, 255, 255, 0.95); --border: rgba(0,0,0,0.1); }
        body { background-color: var(--bg-body); color: var(--text-main); font-family: 'Montserrat', sans-serif; transition: 0.3s; overflow-x: hidden; }
        .glass { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border); }
        .nav-link { font-size: 11px; font-weight: 900; text-transform: uppercase; cursor: pointer; padding: 12px 20px; border-radius: 99px; transition: 0.3s; }
        .active-link { background: #00d2ff !important; color: black !important; box-shadow: 0 0 15px rgba(0, 210, 255, 0.4); }
        .mk-toast { position: fixed; top: 20px; right: 20px; background: #000; color: #fff; border-left: 5px solid #00d2ff; padding: 15px 25px; border-radius: 15px; z-index: 10000; font-size: 11px; font-weight: 900; animation: slideIn 0.3s forwards; }
        @keyframes slideIn { from { transform: translateX(120%); } to { transform: translateX(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="dark">

    <div id="toast-container"></div>

    <nav class="glass sticky top-0 z-[100] px-6 py-4 flex justify-between items-center border-b">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-3 cursor-pointer" onclick="showSection('shop')">
                <div class="w-10 h-10 bg-mkBlue rounded-xl flex items-center justify-center font-black text-black">MK</div>
                <h1 class="text-xl font-black italic uppercase">MK <span class="text-mkBlue">SHOP</span></h1>
            </div>
            
            <div class="hidden lg:flex gap-1 bg-black/10 p-1 rounded-full border border-white/5">
                <button id="nav-shop" class="nav-link active-link" onclick="showSection('shop')">üõí Boutique</button>
                <button id="nav-gamble" class="nav-link" onclick="showSection('gamble')">üé≤ Jeux</button>
                <button id="nav-leaderboard" class="nav-link" onclick="showSection('leaderboard')">üèÜ Top 10</button>
                <button id="nav-profile" class="nav-link" onclick="showSection('profile')">üë§ Profil</button>
                <button id="nav-tv" class="nav-link hidden text-mkPurple" onclick="showSection('tv')">üì∫ TV VIP</button>
                <button id="nav-admin" class="nav-link hidden text-mkAdmin" onclick="showSection('admin')">‚ö° Admin</button>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <button onclick="toggleTheme()" class="p-2 glass rounded-xl">üåì</button>
            <div class="flex items-center gap-3 bg-mkGreen/10 border-2 border-mkGreen/40 px-4 py-2 rounded-xl">
                <p id="top-balance-val" class="text-lg font-black text-mkGreen">0.00‚Ç¨</p>
                <span class="text-xl">üí∞</span>
            </div>
            <div id="user-display" class="hidden flex items-center gap-2 bg-white/5 p-1 rounded-xl">
                <img id="user-pfp-nav" src="" class="w-8 h-8 rounded-lg object-cover border border-mkBlue">
                <button onclick="logout()" class="text-mkRed font-black text-[10px] px-2">‚úï</button>
            </div>
            <button id="auth-btn" onclick="openModal('auth-modal')" class="bg-mkBlue text-black text-[10px] font-black px-6 py-3 rounded-xl uppercase">Connexion</button>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 py-10 lg:pr-[320px]">

        <div id="section-shop" class="content-section space-y-10">
            <div class="flex justify-between items-center">
                <h2 class="text-4xl font-black italic uppercase">Catalogue</h2>
                <div class="flex gap-2 bg-black/40 p-2 rounded-2xl border border-white/10">
                    <input id="shop-code" type="text" placeholder="CODE CADEAU" class="bg-transparent outline-none px-4 text-[10px] font-black uppercase w-32 text-white">
                    <button onclick="useCode('shop-code')" class="bg-mkBlue text-black px-4 py-2 rounded-xl font-black text-[9px] uppercase">Activer</button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass p-8 rounded-[2.5rem] border-t-8 border-mkBlue">
                    <h3 class="text-3xl font-black uppercase italic mb-2">Comptes Roblox</h3>
                    <p class="text-xs opacity-60 mb-8">Comptes avec Robux / Skins rares.</p>
                    <button onclick="openSupport('Roblox')" class="w-full bg-white text-black py-4 rounded-2xl font-black uppercase">Acheter (5‚Ç¨ - 30‚Ç¨)</button>
                </div>
                <div class="glass p-8 rounded-[2.5rem] border-t-8 border-mkYellow">
                    <h3 class="text-3xl font-black uppercase italic mb-2">Comptes Premium</h3>
                    <p class="text-xs opacity-60 mb-8">Spotify, Netflix, Disney+ garantis.</p>
                    <button onclick="openSupport('Premium')" class="w-full bg-mkYellow text-black py-4 rounded-2xl font-black uppercase">Acheter (3‚Ç¨ - 20‚Ç¨)</button>
                </div>
                <div class="glass p-8 rounded-[2.5rem] border-t-8 border-mkPurple">
                    <h3 class="text-3xl font-black uppercase italic mb-2">Acc√®s TV VIP</h3>
                    <p class="text-xs opacity-60 mb-8">D√©bloquez l'onglet TV avec un code ou achat.</p>
                    <button onclick="openSupport('TV')" class="w-full bg-mkPurple text-white py-4 rounded-2xl font-black uppercase">D√©bloquer (3‚Ç¨)</button>
                </div>
                <div class="glass p-8 rounded-[2.5rem] border-t-8 border-mkGreen">
                    <h3 class="text-3xl font-black uppercase italic mb-2">Demande Staff</h3>
                    <p class="text-xs opacity-60 mb-8">Recrutement ou commande personnalis√©e.</p>
                    <button onclick="openSupport('Staff')" class="w-full bg-mkGreen text-black py-4 rounded-2xl font-black uppercase">Contacter (1‚Ç¨)</button>
                </div>
            </div>
        </div>

        <div id="section-gamble" class="content-section hidden space-y-10">
            <div class="flex justify-between items-end">
                <h2 class="text-4xl font-black italic uppercase">Casino <span class="text-mkYellow">MK</span></h2>
                <button onclick="handleCashout()" class="bg-mkGreen text-black px-6 py-3 rounded-xl font-black text-xs uppercase shadow-[0_0_15px_rgba(34,197,94,0.4)]">üí∏ Retirer (Cashout)</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass p-8 rounded-[3rem] text-center">
                    <div id="coin-visual" class="text-6xl mb-4">ü™ô</div>
                    <input id="bet-coin" type="number" value="1" class="bg-black/40 w-full p-4 rounded-xl text-center font-black mb-4 outline-none">
                    <button onclick="playCoin()" class="w-full bg-mkBlue text-black font-black py-4 rounded-xl uppercase italic">Jouer Pile ou Face</button>
                </div>
                <div class="glass p-8 rounded-[3rem] text-center">
                    <div id="dice-visual" class="text-6xl mb-4">üé≤</div>
                    <input id="bet-dice" type="number" value="1" class="bg-black/40 w-full p-4 rounded-xl text-center font-black mb-4 outline-none">
                    <button onclick="playDice()" class="w-full bg-mkRed text-white font-black py-4 rounded-xl uppercase italic">Lancer le D√©</button>
                </div>
                <div class="glass p-8 rounded-[3rem] text-center col-span-1 md:col-span-2">
                    <div id="slots-visual" class="text-4xl mb-6 font-black tracking-widest bg-black/40 py-4 rounded-2xl italic">‚ùì | ‚ùì | ‚ùì</div>
                    <input id="bet-slots" type="number" value="2" class="bg-black/40 w-full p-4 rounded-xl text-center font-black mb-4 outline-none">
                    <button onclick="playSlots()" class="w-full bg-mkPurple text-white font-black py-4 rounded-xl uppercase">Spin (JACKPOT x10)</button>
                </div>
            </div>
        </div>

        <div id="section-profile" class="content-section hidden space-y-8">
            <div class="glass p-10 rounded-[4rem] text-center border-t-8 border-mkBlue">
                <img id="prof-pfp" src="" class="w-32 h-32 rounded-[2.5rem] mx-auto mb-6 border-4 border-mkBlue object-cover">
                <h2 id="prof-user" class="text-4xl font-black uppercase italic mb-8">---</h2>
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-black/20 p-6 rounded-3xl"><p class="text-[10px] opacity-50 uppercase font-black italic">Solde</p><h4 id="prof-cash" class="text-2xl font-black text-mkGreen">0.00‚Ç¨</h4></div>
                    <div class="bg-black/20 p-6 rounded-3xl"><p class="text-[10px] opacity-50 uppercase font-black italic">Niveau</p><h4 id="prof-xp" class="text-2xl font-black text-mkYellow">0 XP</h4></div>
                </div>
                <div class="space-y-4 max-w-sm mx-auto">
                    <input id="new-pfp-url" type="text" placeholder="URL Image Avatar" class="w-full bg-black/40 p-4 rounded-xl outline-none text-xs text-center border border-white/5">
                    <button onclick="updatePFP()" class="w-full bg-white text-black py-3 rounded-xl text-[10px] font-black uppercase">Changer de Photo</button>
                    
                    <div class="flex gap-2 pt-4 border-t border-white/10">
                        <input id="profile-code" type="text" placeholder="CODE ACTIVATION" class="bg-black/40 flex-1 p-4 rounded-xl outline-none text-center font-black uppercase text-xs border border-mkPurple/30">
                        <button onclick="useCode('profile-code')" class="bg-mkPurple text-white px-6 rounded-xl font-black text-xs uppercase">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-tv" class="content-section hidden space-y-6">
            <h2 class="text-4xl font-black italic uppercase text-center">MK <span class="text-mkPurple">TV VIP</span></h2>
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <div class="glass p-4 rounded-[2rem] h-[500px] overflow-y-auto no-scrollbar space-y-4">
                    <p class="text-[10px] font-black text-mkBlue uppercase opacity-50 px-2 italic">Biblioth√®que</p>
                    <div class="space-y-1">
                        <button onclick="setVideo('One Piece - EP 1', 'https://www.youtube.com/embed/S8_YwFLCh4U')" class="w-full text-left p-3 rounded-xl text-[10px] font-bold bg-white/5 hover:bg-mkBlue hover:text-black transition">üè¥‚Äç‚ò†Ô∏è One Piece</button>
                        <button onclick="setVideo('Naruto - EP 1', 'https://www.youtube.com/embed/1vRzN7p0f8Y')" class="w-full text-left p-3 rounded-xl text-[10px] font-bold bg-white/5 hover:bg-mkRed transition">ü¶ä Naruto</button>
                        <button onclick="setVideo('Dragon Ball Z', 'https://www.youtube.com/embed/Sx-C5yF2yJk')" class="w-full text-left p-3 rounded-xl text-[10px] font-bold bg-white/5 hover:bg-mkYellow hover:text-black transition">üêâ DBZ</button>
                        <button onclick="setVideo('Hunter x Hunter', 'https://www.youtube.com/embed/d6kBeWjQDqA')" class="w-full text-left p-3 rounded-xl text-[10px] font-bold bg-white/5 hover:bg-mkPurple transition">‚ö° Hunter x Hunter</button>
                        <button onclick="setVideo('Jujutsu Kaisen', 'https://www.youtube.com/embed/S2C_P4tU_3Y')" class="w-full text-left p-3 rounded-xl text-[10px] font-bold bg-white/5 hover:bg-mkGreen hover:text-black transition">üëπ Jujutsu Kaisen</button>
                        <button onclick="setVideo('Bob l\'√©ponge', 'https://www.youtube.com/embed/2sFFj6X85Q4')" class="w-full text-left p-3 rounded-xl text-[10px] font-bold bg-white/5 hover:bg-blue-400 transition">üçç Bob l'√©ponge</button>
                    </div>
                </div>
                <div class="lg:col-span-3 space-y-4">
                    <div class="bg-black rounded-[3rem] aspect-video overflow-hidden border-4 border-mkPurple/20 shadow-2xl">
                        <iframe id="video-frame" class="w-full h-full" src="" frameborder="0" allowfullscreen></iframe>
                    </div>
                    <div class="glass p-6 rounded-3xl flex justify-between items-center">
                        <h4 id="video-title" class="text-xl font-black italic uppercase">S√©lectionnez un programme</h4>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-leaderboard" class="content-section hidden">
            <h2 class="text-4xl font-black italic uppercase text-center mb-8">Top 10 Fortunes</h2>
            <div id="leaderboard-list" class="glass rounded-[3rem] overflow-hidden"></div>
        </div>

        <div id="section-admin" class="content-section hidden space-y-6">
            <h2 class="text-4xl font-black text-mkAdmin italic uppercase">Admin</h2>
            <div id="admin-user-list" class="space-y-4"></div>
        </div>

    </main>

    <aside class="fixed right-6 top-28 bottom-8 w-72 glass rounded-[2.5rem] hidden xl:flex flex-col overflow-hidden z-[40]">
        <div class="p-4 bg-mkBlue/10 text-mkBlue font-black uppercase text-[10px] text-center italic">Global Chat</div>
        <div id="public-messages" class="flex-1 p-4 overflow-y-auto space-y-4 no-scrollbar"></div>
        <div class="p-4 border-t border-white/5">
            <div class="flex gap-2 bg-black/20 p-2 rounded-xl">
                <input id="public-input" type="text" placeholder="Message..." class="bg-transparent outline-none text-[11px] flex-1 px-2 font-bold">
                <button onclick="sendPublicMessage()" class="w-8 h-8 bg-mkBlue text-black rounded-lg font-black">></button>
            </div>
        </div>
    </aside>

    <div id="auth-modal" class="hidden fixed inset-0 z-[1000] bg-black/95 flex items-center justify-center p-6">
        <div class="glass p-10 rounded-[3rem] w-full max-w-sm text-center border-t-8 border-mkBlue">
            <h3 class="text-2xl font-black mb-6 text-white uppercase italic">MK Connexion</h3>
            <div class="space-y-3">
                <input id="in-email" type="email" placeholder="Email" class="w-full bg-white/5 p-4 rounded-xl outline-none text-center font-bold">
                <input id="in-user" type="text" placeholder="Pseudo" class="w-full bg-white/5 p-4 rounded-xl outline-none text-center font-bold">
                <input id="in-pass" type="password" placeholder="Mot de passe" class="w-full bg-white/5 p-4 rounded-xl outline-none text-center font-bold">
                <button onclick="handleAuth()" class="w-full bg-mkBlue text-black font-black py-4 rounded-xl uppercase">Valider</button>
            </div>
        </div>
    </div>

    <script>
        const SB_URL = "https://eeiuxfcgysrarctokuyg.supabase.co"; 
        const SB_KEY = "sb_publishable_0fuup_i-vDgKHozqpz706A_4tGWghxn";
        const db = supabase.createClient(SB_URL, SB_KEY);
        let user = null;

        function toggleTheme() { document.body.classList.toggle('light'); document.body.classList.toggle('dark'); }

        function mkNotify(msg, color='mkBlue') {
            const t = document.createElement('div');
            t.className = `mk-toast`; t.style.borderLeftColor = `var(--${color})`;
            t.innerText = msg; document.body.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }

        async function handleAuth() {
            const e = document.getElementById('in-email').value.trim();
            const u = document.getElementById('in-user').value.trim();
            const p = document.getElementById('in-pass').value.trim();
            if(!e || !p) return;
            let { data: prof } = await db.from('profiles').select('*').eq('email', e).maybeSingle();
            if(!prof) {
                const { data } = await db.from('profiles').insert([{ 
                    username: u || "User", email: e, password: p, balance: 10, xp: 0, 
                    pfp: `https://api.dicebear.com/7.x/pixel-art/svg?seed=${e}`, tv_access: false
                }]).select().single();
                prof = data;
            }
            user = prof; localStorage.setItem('mk_session', JSON.stringify(user)); location.reload();
        }

        function syncUser() {
            if(!user) return;
            document.getElementById('user-display').classList.remove('hidden');
            document.getElementById('auth-btn').classList.add('hidden');
            document.getElementById('top-balance-val').innerText = user.balance.toFixed(2) + "‚Ç¨";
            document.getElementById('prof-cash').innerText = user.balance.toFixed(2) + "‚Ç¨";
            document.getElementById('prof-xp').innerText = Math.floor(user.xp) + " XP";
            document.getElementById('prof-user').innerText = user.username;
            document.getElementById('prof-pfp').src = user.pfp;
            document.getElementById('user-pfp-nav').src = user.pfp;
            if(user.tv_access) document.getElementById('nav-tv').classList.remove('hidden');
            if(user.username.toLowerCase() === 'admin') document.getElementById('nav-admin').classList.remove('hidden');
        }

        // --- SYSTEME DE CODE UNIFI√â ---
        async function useCode(inputId) {
            const code = document.getElementById(inputId).value.trim();
            if(!code || !user) return mkNotify("Entrez un code", "mkRed");

            if(code === "TVVIP2024") {
                const { data } = await db.from('profiles').update({ tv_access: true }).eq('id', user.id).select().single();
                user = data; syncUser();
                mkNotify("üì∫ Acc√®s TV D√©bloqu√© !", "mkPurple");
            } else if(code.startsWith("MK50")) {
                const { data } = await db.from('profiles').update({ balance: user.balance + 50 }).eq('id', user.id).select().single();
                user = data; syncUser();
                mkNotify("üí∞ +50‚Ç¨ Ajout√©s !", "mkGreen");
            } else {
                mkNotify("‚ùå Code Invalide", "mkRed");
            }
            document.getElementById(inputId).value = "";
        }

        function setVideo(title, url) {
            document.getElementById('video-frame').src = url;
            document.getElementById('video-title').innerText = title;
            mkNotify("Lecture : " + title, "mkPurple");
        }

        async function playCoin() {
            const bet = parseFloat(document.getElementById('bet-coin').value);
            if(bet > user.balance) return mkNotify("Solde insuffisant", "mkRed");
            const win = Math.random() > 0.5;
            const { data } = await db.from('profiles').update({ balance: win ? user.balance + bet : user.balance - bet, xp: user.xp + 5 }).eq('id', user.id).select().single();
            user = data; syncUser(); mkNotify(win ? "GAGN√â !" : "PERDU", win ? "mkGreen" : "mkRed");
        }

        async function playDice() {
            const bet = parseFloat(document.getElementById('bet-dice').value);
            if(bet > user.balance) return mkNotify("Solde insuffisant", "mkRed");
            const res = Math.floor(Math.random() * 6) + 1;
            const win = res >= 4;
            const { data } = await db.from('profiles').update({ balance: win ? user.balance + bet : user.balance - bet, xp: user.xp + 5 }).eq('id', user.id).select().single();
            user = data; syncUser(); mkNotify("D√â : " + res, win ? "mkGreen" : "mkRed");
        }

        async function playSlots() {
            const bet = parseFloat(document.getElementById('bet-slots').value);
            if(bet > user.balance) return mkNotify("Solde insuffisant", "mkRed");
            const win = Math.random() < 0.1;
            const { data } = await db.from('profiles').update({ balance: win ? user.balance + (bet*10) : user.balance - bet, xp: user.xp + 10 }).eq('id', user.id).select().single();
            user = data; syncUser(); mkNotify(win ? "JACKPOT x10 !" : "PERDU", win ? "mkYellow" : "mkRed");
        }

        function showSection(id) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.add('hidden'));
            document.getElementById('section-' + id).classList.remove('hidden');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active-link'));
            if(document.getElementById('nav-'+id)) document.getElementById('nav-'+id).classList.add('active-link');
            if(id === 'leaderboard') fetchLeaderboard();
        }

        async function fetchLeaderboard() {
            const { data } = await db.from('profiles').select('username, balance, pfp').order('balance', { ascending: false }).limit(10);
            document.getElementById('leaderboard-list').innerHTML = data.map((u, i) => `
                <div class="flex items-center justify-between p-5 border-b border-white/5 bg-black/5">
                    <div class="flex items-center gap-4">
                        <span class="font-black italic opacity-30">#${i+1}</span>
                        <img src="${u.pfp}" class="w-8 h-8 rounded-lg object-cover">
                        <b class="uppercase italic text-xs">${u.username}</b>
                    </div>
                    <span class="text-mkGreen font-black">${u.balance.toFixed(2)}‚Ç¨</span>
                </div>`).join('');
        }

        window.onload = async () => {
            const saved = localStorage.getItem('mk_session');
            if (saved) {
                const parsed = JSON.parse(saved);
                const { data } = await db.from('profiles').select('*').eq('id', parsed.id).single();
                if (data) { user = data; syncUser(); }
            }
        };

        function logout() { localStorage.clear(); location.reload(); }
        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function openSupport(i) { mkNotify("Ticket Support: " + i); }
    </script>
</body>
</html>
