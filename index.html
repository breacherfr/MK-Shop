<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MK SHOP | SUPREME PLATINUM V72.5</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800;900&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        mkBlue: '#00d2ff',
                        mkRed: '#ff4b5c',
                        mkPurple: '#a363ff',
                        mkYellow: '#fbbf24',
                        mkGreen: '#22c55e',
                        mkAdmin: '#ff00ff',
                        mkDarker: '#020202',
                        mkCard: '#0a0a0c'
                    },
                    borderRadius: {
                        '4xl': '2rem',
                        '5xl': '3rem',
                        '6xl': '5rem'
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* BASE STYLES */
        body { 
            font-family: 'Montserrat', sans-serif; 
            background-color: #030303; 
            color: #ffffff; 
            overflow-x: hidden;
            letter-spacing: -0.02em;
        }

        .font-sync { font-family: 'Syncopate', sans-serif; }

        /* GLASSMORPHISM EVOLUTION */
        .glass { 
            backdrop-filter: blur(40px); 
            background: rgba(15, 15, 18, 0.98); 
            border: 1px solid rgba(255, 255, 255, 0.04); 
        }

        .glass-hover:hover {
            background: rgba(25, 25, 30, 0.99);
            border: 1px solid rgba(0, 210, 255, 0.2);
            transform: translateY(-5px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* ANIMATIONS DE CHARGEMENT */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-view { animation: fadeInUp 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards; }

        /* CHAT FIXED SYSTEM - STRICT RIGHT SIDE */
        #side-chat-container {
            position: fixed;
            top: 100px;
            right: 20px;
            bottom: 25px;
            width: 400px;
            z-index: 5000;
            display: flex;
            flex-direction: column;
            border-radius: 3rem;
            overflow: hidden;
            box-shadow: 0 50px 100px -20px rgba(0,0,0,0.9);
            border: 1px solid rgba(255,255,255,0.06);
            resize: none !important;
        }

        /* DASHBOARD SECTIONING */
        .content-wrapper {
            margin-right: 440px; /* Space for the chat */
            padding: 40px;
        }

        /* SCROLLBAR CUSTOMIZATION */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #1a1a1a; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #00d2ff; }
        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* NOTIFICATION TOAST */
        .toast-mk {
            position: fixed;
            bottom: 40px;
            left: 40px;
            z-index: 10000;
            padding: 20px 40px;
            border-radius: 20px;
            background: #000;
            border-left: 5px solid #00d2ff;
            font-weight: 900;
            text-transform: uppercase;
            font-size: 11px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* TAB NAVIGATION */
        .tab-btn {
            position: relative;
            transition: all 0.3s;
        }
        .tab-btn.active { color: #00d2ff; }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #00d2ff;
        }

        /* SLOTS MACHINE ANIMATION */
        .slot-box {
            background: linear-gradient(180deg, #111 0%, #050505 100%);
            border: 2px solid rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 20px;
            font-size: 3rem;
            min-width: 80px;
        }
    </style>
</head>
<body class="dark overflow-y-scroll">

    <nav class="glass sticky top-0 z-[6000] px-12 py-7 flex justify-between items-center border-b border-white/5">
        <div class="flex items-center gap-14">
            <div class="flex items-center gap-5 cursor-pointer group" onclick="showSection('shop')">
                <div class="relative">
                    <div class="absolute inset-0 bg-mkBlue blur-xl opacity-20 group-hover:opacity-50 transition"></div>
                    <div class="w-14 h-14 bg-mkBlue rounded-2xl flex items-center justify-center font-black text-black text-2xl relative">MK</div>
                </div>
                <div>
                    <h1 class="font-black text-2xl italic tracking-tighter leading-none font-sync">MK SHOP</h1>
                    <span class="text-[9px] font-bold text-mkBlue uppercase tracking-[0.4em] opacity-80">Supreme v72.5 Platinum</span>
                </div>
            </div>
            
            <div class="hidden xl:flex gap-10 items-center">
                <button onclick="showSection('shop')" class="tab-btn text-[10px] font-black uppercase tracking-widest opacity-50 hover:opacity-100">Marketplace</button>
                <button onclick="showSection('games')" class="tab-btn text-[10px] font-black uppercase tracking-widest opacity-50 hover:opacity-100">Casino VIP</button>
                <button onclick="showSection('leaderboard')" class="tab-btn text-[10px] font-black uppercase tracking-widest opacity-50 hover:opacity-100">Leaderboard</button>
                <button onclick="showSection('profile')" class="tab-btn text-[10px] font-black uppercase tracking-widest opacity-50 hover:opacity-100">Mon Profil</button>
                <button id="nav-admin" onclick="showSection('admin')" class="hidden bg-mkAdmin/10 text-mkAdmin border border-mkAdmin/20 px-4 py-1.5 rounded-full text-[9px] font-black uppercase tracking-widest">Admin Console</button>
            </div>
        </div>

        <div class="flex items-center gap-8">
            <div class="flex bg-mkDarker rounded-2xl p-1.5 border border-white/5">
                <button id="m-cash" onclick="setMode('cash')" class="px-6 py-2.5 rounded-xl text-[10px] font-black bg-mkGreen text-black shadow-2xl transition-all duration-500">WALLET</button>
                <button id="m-xp" onclick="setMode('xp')" class="px-6 py-2.5 rounded-xl text-[10px] font-black opacity-30 text-white transition-all duration-500">XP LEVEL</button>
            </div>
            
            <div class="bg-black/40 px-8 py-3 rounded-2xl border border-white/10 min-w-[150px] text-center">
                <span id="val-display" class="font-black text-mkGreen text-xl tracking-tighter italic">0.00‚Ç¨</span>
            </div>

            <div id="auth-zone">
                <button onclick="openModal('modal-auth')" class="bg-white text-black px-8 py-4 rounded-2xl font-black text-[10px] uppercase shadow-xl hover:bg-mkBlue transition-all">Connexion</button>
            </div>

            <div id="user-zone" class="hidden flex items-center gap-4 border-l border-white/10 pl-8">
                <div class="text-right">
                    <p id="u-name-display" class="text-[10px] font-black uppercase tracking-tighter">Membre</p>
                    <p class="text-[8px] font-bold text-mkBlue opacity-50">En ligne</p>
                </div>
                <img id="u-pfp" src="" class="w-12 h-12 rounded-2xl border-2 border-mkBlue object-cover shadow-lg shadow-mkBlue/20">
                <button onclick="logout()" class="w-10 h-10 flex items-center justify-center bg-mkRed/10 text-mkRed rounded-xl hover:bg-mkRed hover:text-white transition-all">‚úï</button>
            </div>
        </div>
    </nav>

    <div class="content-wrapper">
        
        <section id="s-shop" class="animate-view space-y-16">
            <header class="max-w-4xl">
                <h2 class="text-8xl font-black italic uppercase tracking-tighter leading-[0.85]">Find Your <br><span class="text-mkBlue">Luxury</span> Items.</h2>
                <p class="mt-6 text-sm opacity-40 font-medium max-w-xl">Bienvenue sur le marketplace MK. Tous nos comptes sont v√©rifi√©s manuellement par notre √©quipe pour garantir une s√©curit√© totale apr√®s achat.</p>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="glass p-12 rounded-6xl glass-hover group">
                    <div class="flex justify-between items-start">
                        <div class="w-20 h-20 bg-mkBlue/10 rounded-3xl flex items-center justify-center text-4xl group-hover:scale-110 transition">üéÆ</div>
                        <span class="bg-mkBlue/20 text-mkBlue px-4 py-1.5 rounded-full text-[9px] font-black uppercase">Stock: 14</span>
                    </div>
                    <h3 class="text-3xl font-black uppercase italic mt-10">Comptes Roblox</h3>
                    <p class="text-xs opacity-40 mt-4 leading-relaxed">Acc√®s exclusif √† des comptes avec inventaires Limiteds, fruits permanents (Blox Fruits) et badges rares. Full mail access inclus.</p>
                    <div class="mt-12 flex justify-between items-center">
                        <div class="flex flex-col">
                            <span class="text-[10px] opacity-30 font-bold uppercase">√Ä partir de</span>
                            <span class="text-2xl font-black italic">14.99‚Ç¨</span>
                        </div>
                        <button onclick="openTicket('Achat Roblox')" class="bg-white text-black px-10 py-5 rounded-2xl font-black text-[11px] uppercase hover:bg-mkBlue transition-all shadow-lg shadow-white/5">Commander</button>
                    </div>
                </div>

                <div class="glass p-12 rounded-6xl glass-hover group border-t-4 border-mkPurple">
                    <div class="flex justify-between items-start">
                        <div class="w-20 h-20 bg-mkPurple/10 rounded-3xl flex items-center justify-center text-4xl group-hover:scale-110 transition">‚ö°</div>
                        <span class="bg-mkPurple/20 text-mkPurple px-4 py-1.5 rounded-full text-[9px] font-black uppercase">Instant Delivery</span>
                    </div>
                    <h3 class="text-3xl font-black uppercase italic mt-10 text-mkPurple">Scripts Premium</h3>
                    <p class="text-xs opacity-40 mt-4 leading-relaxed">Menus d'injection priv√©s pour FPS et MMORPG. Ind√©tectables par les derniers anti-cheats. Mises √† jour hebdomadaires.</p>
                    <div class="mt-12 flex justify-between items-center">
                        <div class="flex flex-col">
                            <span class="text-[10px] opacity-30 font-bold uppercase">Licence</span>
                            <span class="text-2xl font-black italic">9.99‚Ç¨ <small class="text-[10px]">/MOIS</small></span>
                        </div>
                        <button onclick="openTicket('Achat Cheat')" class="bg-mkPurple text-white px-10 py-5 rounded-2xl font-black text-[11px] uppercase shadow-xl shadow-mkPurple/20">Voir les Offres</button>
                    </div>
                </div>

                <div id="tv-card" class="md:col-span-2 glass p-16 rounded-[4rem] border-2 border-mkAdmin relative overflow-hidden flex flex-col lg:flex-row items-center gap-16">
                    <div class="absolute top-0 right-0 p-10 opacity-5 pointer-events-none">
                        <span class="text-[15rem] font-black italic">VIP</span>
                    </div>
                    <div class="relative z-10 flex-1">
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-12 h-1 flex bg-mkAdmin rounded-full"></div>
                            <span class="text-mkAdmin font-black text-xs uppercase tracking-[0.5em]">Exclusive Service</span>
                        </div>
                        <h3 class="text-6xl font-black italic uppercase leading-none text-white">MK Cinema <br><span class="text-mkAdmin italic">Streaming VIP</span></h3>
                        <p class="text-sm opacity-40 mt-8 max-w-md font-medium">Acc√©dez √† plus de 45,000 films et s√©ries en ultra haute d√©finition. N√©cessite un code d'acc√®s MK Premium.</p>
                    </div>
                    <div class="relative z-10 w-full max-w-md space-y-6">
                        <div class="bg-black/60 p-10 rounded-[3rem] border border-white/5 shadow-inner">
                            <label class="text-[9px] font-black uppercase opacity-40 mb-3 block tracking-widest">Code Activation</label>
                            <input id="tv-code" type="text" placeholder="XXXX-XXXX-XXXX" class="w-full bg-mkDarker p-5 rounded-2xl text-xs font-black outline-none border border-white/5 focus:border-mkAdmin transition text-center tracking-[0.3em] uppercase mb-6">
                            <button onclick="unlockTV()" class="w-full bg-mkAdmin text-white py-5 rounded-2xl font-black text-[11px] uppercase shadow-2xl shadow-mkAdmin/30 hover:scale-[1.02] transition-all">D√©bloquer l'acc√®s</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass p-12 rounded-[5rem] border-2 border-mkRed flex flex-col lg:flex-row justify-between items-center gap-10">
                <div class="flex items-center gap-10">
                    <div class="w-24 h-24 bg-mkRed/10 rounded-full flex items-center justify-center text-5xl animate-pulse">üí∞</div>
                    <div>
                        <h4 class="text-4xl font-black text-mkRed uppercase italic italic leading-none">Cashout System</h4>
                        <p class="text-xs opacity-40 uppercase font-bold tracking-widest mt-2 italic">Retrait de vos gains casino vers PayPal, Crypto ou Gift Cards.</p>
                    </div>
                </div>
                <div class="flex gap-4">
                    <button onclick="openTicket('CASHOUT')" class="bg-mkRed text-white px-12 py-5 rounded-2xl font-black text-[11px] uppercase shadow-2xl shadow-mkRed/40">Demander un retrait</button>
                    <button onclick="openTicket('Support')" class="bg-white/5 border border-white/10 text-white px-12 py-5 rounded-2xl font-black text-[11px] uppercase">Aide</button>
                </div>
            </div>
        </section>

        <section id="s-games" class="hidden animate-view space-y-16">
            <header class="text-center">
                <h2 class="text-7xl font-black italic uppercase tracking-tighter">MK <span class="text-mkRed">Luxury Casino</span></h2>
                <p class="text-[10px] font-bold opacity-30 uppercase tracking-[0.5em] mt-4">Provably Fair System ‚Ä¢ High Roller Only</p>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="glass p-16 rounded-6xl text-center border-b-8 border-mkBlue">
                    <h3 class="text-xs font-black uppercase opacity-30 tracking-widest mb-10">Coin Flip Double Or Nothing</h3>
                    <div id="coin-res" class="text-[10rem] mb-12 animate-float">ü™ô</div>
                    <div class="max-w-xs mx-auto space-y-6">
                        <div class="relative">
                            <span class="absolute left-6 top-1/2 -translate-y-1/2 font-black text-xs opacity-20 uppercase">Mise</span>
                            <input id="bet-coin" type="number" value="10" class="w-full bg-black/50 py-5 px-16 rounded-2xl text-2xl font-black text-center outline-none border border-white/5 focus:border-mkBlue">
                        </div>
                        <div class="flex gap-4">
                            <button onclick="playGame('coin', 'pile')" class="flex-1 bg-mkBlue text-black py-5 rounded-2xl font-black text-[11px] uppercase shadow-lg shadow-mkBlue/20">Miser Pile</button>
                            <button onclick="playGame('coin', 'face')" class="flex-1 bg-white text-black py-5 rounded-2xl font-black text-[11px] uppercase">Miser Face</button>
                        </div>
                    </div>
                </div>

                <div class="glass p-16 rounded-6xl text-center border-b-8 border-mkPurple">
                    <h3 class="text-xs font-black uppercase opacity-30 tracking-widest mb-10">MK Triple Slots x15</h3>
                    <div class="flex justify-center gap-6 mb-12">
                        <div id="sl1" class="slot-box font-sync">üçí</div>
                        <div id="sl2" class="slot-box font-sync">üçí</div>
                        <div id="sl3" class="slot-box font-sync">üçí</div>
                    </div>
                    <div class="max-w-xs mx-auto space-y-6">
                        <input id="bet-slots" type="number" value="10" class="w-full bg-black/50 py-5 rounded-2xl text-2xl font-black text-center outline-none border border-white/5">
                        <button onclick="playGame('slots')" class="w-full bg-mkPurple text-white py-6 rounded-2xl font-black text-[12px] uppercase shadow-2xl shadow-mkPurple/30 group">
                            <span class="group-hover:tracking-widest transition-all">Actionner le Levier</span>
                        </button>
                    </div>
                </div>

                <div class="glass p-16 rounded-6xl text-center border-b-8 border-mkYellow">
                    <h3 class="text-xs font-black uppercase opacity-30 tracking-widest mb-10">Master Dice Roll</h3>
                    <div id="dice-res" class="text-[10rem] mb-12 text-mkYellow">üé≤</div>
                    <div class="max-w-xs mx-auto space-y-6">
                        <input id="bet-dice" type="number" value="10" class="w-full bg-black/50 py-5 rounded-2xl text-2xl font-black text-center outline-none border border-white/5">
                        <button onclick="playGame('dice')" class="w-full bg-mkYellow text-black py-5 rounded-2xl font-black text-[11px] uppercase shadow-xl">Lancer (4+ pour win)</button>
                    </div>
                </div>

                <div class="glass p-16 rounded-6xl text-center border-b-8 border-mkGreen">
                    <h3 class="text-xs font-black uppercase opacity-30 tracking-widest mb-10">Chifoumi Royal (Multiplier x3)</h3>
                    <div class="flex justify-center gap-6 mb-12">
                        <button onclick="playGame('rps', 'pierre')" class="w-24 h-24 glass rounded-3xl text-4xl hover:bg-mkBlue transition-all">‚úä</button>
                        <button onclick="playGame('rps', 'feuille')" class="w-24 h-24 glass rounded-3xl text-4xl hover:bg-mkBlue transition-all">‚úã</button>
                        <button onclick="playGame('rps', 'ciseaux')" class="w-24 h-24 glass rounded-3xl text-4xl hover:bg-mkBlue transition-all">‚úåÔ∏è</button>
                    </div>
                    <div class="max-w-xs mx-auto">
                        <input id="bet-rps" type="number" value="10" class="w-full bg-black/50 py-5 rounded-2xl text-2xl font-black text-center outline-none border border-white/5">
                    </div>
                </div>
            </div>
        </section>

        <section id="s-leaderboard" class="hidden animate-view space-y-12">
            <div class="text-center">
                <h2 class="text-6xl font-black uppercase italic italic font-sync">Hall of <span class="text-mkGreen">Fame</span></h2>
                <p class="text-xs opacity-30 uppercase font-black tracking-[0.4em] mt-4 italic">Les 10 plus grandes fortunes de MK Shop</p>
            </div>
            
            <div id="leader-container" class="max-w-4xl mx-auto glass rounded-[4rem] overflow-hidden shadow-2xl border border-white/5">
                </div>
        </section>

        <section id="s-profile" class="hidden animate-view max-w-3xl mx-auto space-y-12">
            <div class="glass p-8 rounded-3xl flex gap-6 items-center">
                <div class="w-12 h-12 bg-white/5 rounded-2xl flex items-center justify-center text-xl">üîç</div>
                <input id="search-name" type="text" placeholder="RECHERCHER UN UTILISATEUR..." class="flex-1 bg-transparent font-black outline-none uppercase text-xs tracking-widest">
                <button onclick="findMember()" class="bg-mkBlue text-black px-10 py-4 rounded-2xl font-black text-[10px] uppercase shadow-lg shadow-mkBlue/20">Rechercher</button>
            </div>

            <div id="p-card" class="glass p-20 rounded-[5rem] text-center relative overflow-hidden border-b-[20px] border-mkBlue">
                <div class="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-mkBlue/10 to-transparent"></div>
                
                <img id="p-avatar" src="" class="relative z-10 w-48 h-48 rounded-[4rem] mx-auto object-cover border-8 border-mkDarker shadow-2xl mb-10 hover:scale-105 transition duration-500">
                
                <h3 id="p-username" class="relative z-10 text-5xl font-black italic uppercase tracking-tighter">MK User</h3>
                <div id="p-badge-admin" class="hidden relative z-10 inline-block mt-4 bg-mkAdmin text-white px-4 py-1 rounded-md text-[9px] font-black uppercase">Administrateur</div>
                
                <div class="relative z-10 grid grid-cols-2 gap-8 mt-14">
                    <div class="bg-mkDarker p-10 rounded-[3rem] border border-white/5">
                        <p class="text-[10px] opacity-30 font-black uppercase mb-2 tracking-widest">Balance Wallet</p>
                        <p id="p-val-cash" class="text-4xl font-black text-mkGreen tracking-tighter">0.00‚Ç¨</p>
                    </div>
                    <div class="bg-mkDarker p-10 rounded-[3rem] border border-white/5">
                        <p class="text-[10px] opacity-30 font-black uppercase mb-2 tracking-widest">Experience Points</p>
                        <p id="p-val-xp" class="text-4xl font-black text-mkYellow tracking-tighter">0 XP</p>
                    </div>
                </div>

                <div id="p-controls" class="hidden relative z-10 mt-14 pt-14 border-t border-white/5 space-y-8 text-left">
                    <div class="space-y-4">
                        <label class="text-[10px] font-black uppercase opacity-40 ml-4 tracking-[0.2em]">Lien d'avatar (Image URL)</label>
                        <div class="flex gap-4">
                            <input id="new-pfp-url" type="text" placeholder="https://..." class="flex-1 bg-mkDarker p-5 rounded-2xl text-[11px] font-medium outline-none border border-white/5 focus:border-mkBlue">
                            <button onclick="updatePfp()" class="bg-white text-black px-10 rounded-2xl font-black text-[10px] uppercase">Sauvegarder</button>
                        </div>
                    </div>
                    
                    <div class="bg-mkBlue/5 p-8 rounded-3xl border border-mkBlue/10">
                        <h5 class="text-[10px] font-black uppercase text-mkBlue mb-4">Code Promo / Giftcard</h5>
                        <div class="flex gap-4">
                            <input id="promo-code" type="text" placeholder="ENTER CODE" class="flex-1 bg-black/40 p-4 rounded-xl text-xs font-black uppercase outline-none border border-white/5">
                            <button onclick="usePromo()" class="bg-mkBlue text-black px-8 rounded-xl font-black text-[10px] uppercase">Activer</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="s-admin" class="hidden animate-view space-y-16">
            <header class="flex justify-between items-end">
                <div>
                    <h2 class="text-6xl font-black text-mkAdmin italic uppercase tracking-tighter">Command <span class="text-white">Center</span></h2>
                    <p class="text-xs opacity-40 uppercase font-black mt-2">Gestion globale des utilisateurs et des demandes de support</p>
                </div>
                <div class="bg-mkAdmin/10 p-4 rounded-2xl border border-mkAdmin/20">
                    <span id="adm-stats" class="text-[10px] font-black text-mkAdmin uppercase">Syst√®me Op√©rationnel</span>
                </div>
            </header>

            <div class="grid grid-cols-1 xl:grid-cols-2 gap-12">
                <div class="space-y-8">
                    <h3 class="text-[11px] font-black uppercase text-mkRed tracking-[0.3em] flex items-center gap-4">
                        <span class="w-10 h-[2px] bg-mkRed"></span> Support Tickets
                    </h3>
                    <div id="adm-tickets" class="space-y-4 max-h-[700px] overflow-y-auto pr-4 no-scrollbar">
                        </div>
                </div>

                <div class="space-y-8">
                    <h3 class="text-[11px] font-black uppercase text-mkBlue tracking-[0.3em] flex items-center gap-4">
                        <span class="w-10 h-[2px] bg-mkBlue"></span> Database Members
                    </h3>
                    <div class="bg-mkDarker p-4 rounded-3xl border border-white/5 mb-6">
                        <input id="adm-search" onkeyup="filterAdminUsers()" type="text" placeholder="Filtrer par nom..." class="w-full bg-transparent p-2 outline-none text-xs font-bold uppercase">
                    </div>
                    <div id="adm-users" class="space-y-4 max-h-[700px] overflow-y-auto pr-4 no-scrollbar">
                        </div>
                </div>
            </div>
        </section>

    </div> <div id="side-chat-container" class="glass">
        <div class="flex border-b border-white/5 bg-black/20">
            <button onclick="setChatTab('global')" id="tab-global" class="flex-1 py-7 text-[10px] font-black uppercase tracking-[0.2em] transition-all border-b-2 border-mkBlue text-mkBlue bg-mkBlue/5">Chat Global</button>
            <button onclick="setChatTab('support')" id="tab-support" class="flex-1 py-7 text-[10px] font-black uppercase tracking-[0.2em] transition-all opacity-40 border-b-2 border-transparent">Support Feed</button>
        </div>
        
        <div id="chat-flow" class="flex-1 p-8 overflow-y-auto space-y-6 no-scrollbar scroll-smooth">
            </div>
        
        <div class="p-8 bg-mkDarker border-t border-white/5">
            <div class="relative group">
                <div class="absolute -inset-1 bg-gradient-to-r from-mkBlue to-mkPurple rounded-2xl blur opacity-20 group-focus-within:opacity-50 transition duration-500"></div>
                <div class="relative bg-black rounded-2xl p-2 flex gap-3 border border-white/10">
                    <input id="chat-input" type="text" placeholder="√âcrire un message..." class="bg-transparent flex-1 outline-none px-4 text-xs font-semibold text-white">
                    <button onclick="sendChatMessage()" class="w-14 h-14 bg-mkBlue text-black rounded-xl font-black text-2xl hover:scale-95 transition-all shadow-lg shadow-mkBlue/20">></button>
                </div>
            </div>
            <p class="text-[8px] text-center opacity-20 mt-4 font-bold uppercase tracking-widest">R√®gles : Pas de spam ‚Ä¢ Pas d'insultes ‚Ä¢ MK Staff mod√®re 24/7</p>
        </div>
    </div>

    <div id="modal-auth" class="fixed inset-0 z-[10000] bg-black/95 flex items-center justify-center p-8 hidden">
        <div class="glass w-full max-w-lg rounded-[5rem] p-16 text-center border-t-8 border-mkBlue animate-view">
            <div class="w-20 h-20 bg-mkBlue rounded-3xl mx-auto flex items-center justify-center text-3xl font-black text-black mb-8 shadow-2xl shadow-mkBlue/20">MK</div>
            <h3 class="text-4xl font-black italic uppercase leading-none font-sync">System <span class="text-mkBlue">Login</span></h3>
            <p class="text-[10px] font-bold opacity-30 uppercase tracking-[0.5em] mt-4 mb-12">Identification Requise pour toute action</p>
            
            <div class="space-y-5">
                <div class="text-left">
                    <label class="text-[9px] font-black uppercase opacity-30 ml-4 mb-2 block tracking-widest">Identifiant Unique</label>
                    <input id="in-user" type="text" placeholder="USERNAME" class="w-full bg-mkDarker p-6 rounded-2xl outline-none text-[11px] font-black border border-white/5 focus:border-mkBlue transition text-white uppercase tracking-widest">
                </div>
                <div class="text-left">
                    <label class="text-[9px] font-black uppercase opacity-30 ml-4 mb-2 block tracking-widest">Adresse E-mail (Facultatif)</label>
                    <input id="in-email" type="email" placeholder="EMAIL@EXAMPLE.COM" class="w-full bg-mkDarker p-6 rounded-2xl outline-none text-[11px] font-black border border-white/5 focus:border-mkBlue transition text-white uppercase">
                </div>
                <div class="text-left">
                    <label class="text-[9px] font-black uppercase opacity-30 ml-4 mb-2 block tracking-widest">Code d'acc√®s secret</label>
                    <input id="in-pass" type="password" placeholder="PASSWORD" class="w-full bg-mkDarker p-6 rounded-2xl outline-none text-[11px] font-black border border-white/5 focus:border-mkBlue transition text-white uppercase tracking-widest">
                </div>
                
                <div class="pt-6">
                    <button onclick="processAuth()" class="w-full bg-mkBlue text-black py-6 rounded-3xl font-black text-[12px] uppercase shadow-2xl shadow-mkBlue/20 hover:scale-[1.02] transition-all">Acc√©der au shop</button>
                    <button onclick="closeModal('modal-auth')" class="text-[9px] font-black opacity-20 uppercase mt-8 hover:opacity-100 transition">Annuler et fermer</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATABASE CONFIGURATION ---
        const SB_URL = "https://eeiuxfcgysrarctokuyg.supabase.co";
        const SB_KEY = "sb_publishable_0fuup_i-vDgKHozqpz706A_4tGWghxn";
        const sb = supabase.createClient(SB_URL, SB_KEY);

        // --- GLOBAL STATE ---
        let user = null;
        let currentMode = 'cash';
        let activeChatTab = 'global';
        let lastMessageTimestamp = null;
        let lastTicketCount = 0;
        let chatAutoRefresh = null;

        /**
         * Custom Notification System
         */
        function toast(message, type = 'mkBlue') {
            const container = document.createElement('div');
            container.className = 'toast-mk animate-view';
            container.style.borderLeftColor = `var(--${type})`;
            container.innerHTML = `
                <div class="w-2 h-2 rounded-full bg-current"></div>
                <span>${message}</span>
            `;
            document.body.appendChild(container);
            setTimeout(() => {
                container.style.opacity = '0';
                container.style.transform = 'translateX(-20px)';
                setTimeout(() => container.remove(), 500);
            }, 4000);
        }

        // --- AUTHENTICATION CORE ---

        /**
         * Logic for login and registration
         * Handles optional email and local storage session
         */
        async function processAuth() {
            const u = document.getElementById('in-user').value.trim();
            const e = document.getElementById('in-email').value.trim();
            const p = document.getElementById('in-pass').value.trim();
            
            if(!u || !p) return toast("Pseudo et mot de passe requis", "mkRed");

            // Check if user exists by username
            let { data: existingProfile, error } = await sb.from('profiles')
                .select('*')
                .eq('username', u)
                .maybeSingle();

            if(!existingProfile) {
                // REGISTRATION LOGIC
                const { data, error: registerError } = await sb.from('profiles').insert([{
                    username: u, 
                    email: e || `${u.toLowerCase()}@mk-shop.internal`, 
                    password: p, 
                    balance: 10.00, // Starting bonus
                    xp: 0,
                    pfp: `https://api.dicebear.com/7.x/pixel-art/svg?seed=${u}`,
                    tv_access: false,
                    banned: false,
                    role: u.toLowerCase() === 'admin' ? 'admin' : 'user'
                }]).select().single();
                
                if(registerError) return toast("Erreur lors de la cr√©ation du compte", "mkRed");
                existingProfile = data;
                toast("Compte cr√©√© avec succ√®s ! +10‚Ç¨ offerts.", "mkGreen");
            } else {
                // LOGIN LOGIC
                if(existingProfile.password !== p) return toast("Mot de passe incorrect", "mkRed");
                if(existingProfile.banned) return toast("Votre compte est suspendu par l'administration.", "mkRed");
                toast(`Ravi de vous revoir, ${u} !`, "mkBlue");
            }

            user = existingProfile;
            localStorage.setItem('mk_session_v72_platinum', JSON.stringify(user));
            closeModal('modal-auth');
            initApp();
        }

        /**
         * App Initializer
         */
        function initApp() {
            if(!user) return;
            
            // UI Updates
            document.getElementById('auth-zone').classList.add('hidden');
            document.getElementById('user-zone').classList.remove('hidden');
            document.getElementById('u-pfp').src = user.pfp;
            document.getElementById('u-name-display').innerText = user.username;
            
            // Admin Check
            if(user.role === 'admin' || user.username.toLowerCase() === 'admin') {
                document.getElementById('nav-admin').classList.remove('hidden');
                document.getElementById('p-badge-admin').classList.remove('hidden');
            }

            syncGlobalDisplay();
            
            // Chat System Start
            if(!chatAutoRefresh) {
                loadChatMessages();
                chatAutoRefresh = setInterval(loadChatMessages, 4000);
            }

            // Section Specific Updates
            loadLeaderboard();
        }

        /**
         * Update the money/XP display across the app
         */
        function syncGlobalDisplay() {
            if(!user) return;
            const display = document.getElementById('val-display');
            if(currentMode === 'cash') {
                display.innerText = user.balance.toFixed(2) + "‚Ç¨";
                display.className = "font-black text-mkGreen text-xl tracking-tighter italic";
            } else {
                display.innerText = user.xp + " XP";
                display.className = "font-black text-mkYellow text-xl tracking-tighter italic";
            }
        }

        // --- DATABASE TRANSACTIONS ---

        async function updateStats(newBalance, xpReward = 10) {
            const { data, error } = await sb.from('profiles')
                .update({ 
                    balance: newBalance, 
                    xp: user.xp + xpReward 
                })
                .eq('id', user.id)
                .select()
                .single();
            
            if(!error && data) {
                user = data;
                syncGlobalDisplay();
                // Update profile card if visible
                if(!document.getElementById('s-profile').classList.contains('hidden')) {
                    renderProfileData(user);
                }
            }
        }

        // --- CASINO ENGINE ---

        async function playGame(gameType, selection) {
            if(!user) return toast("Veuillez vous connecter pour jouer", "mkRed");
            
            const betInput = document.getElementById('bet-' + gameType);
            const betAmount = parseFloat(betInput.value);

            if(isNaN(betAmount) || betAmount <= 0) return toast("Mise invalide", "mkRed");
            if(betAmount > user.balance) return toast("Solde insuffisant dans votre Wallet", "mkRed");

            // Game Logic
            if(gameType === 'coin') {
                const win = Math.random() > 0.53; // House edge
                const resultCoin = document.getElementById('coin-res');
                resultCoin.style.transform = 'rotateY(1800deg)';
                
                setTimeout(async () => {
                    resultCoin.style.transform = 'rotateY(0deg)';
                    if(win) {
                        await updateStats(user.balance + betAmount, 20);
                        resultCoin.innerText = selection === 'pile' ? 'ü™ô' : 'üü°';
                        toast(`Gagn√© ! +${betAmount}‚Ç¨`, "mkGreen");
                    } else {
                        await updateStats(user.balance - betAmount, 5);
                        resultCoin.innerText = selection === 'pile' ? 'üü°' : 'ü™ô';
                        toast(`Perdu... -${betAmount}‚Ç¨`, "mkRed");
                    }
                }, 600);
            }

            if(gameType === 'slots') {
                const symbols = ['üíé', 'üçí', 'üçã', '‚≠ê', 'üçá', 'üîî', 'üçÄ'];
                const spin = [
                    symbols[Math.floor(Math.random() * symbols.length)],
                    symbols[Math.floor(Math.random() * symbols.length)],
                    symbols[Math.floor(Math.random() * symbols.length)]
                ];

                document.getElementById('sl1').innerText = '‚è≥';
                document.getElementById('sl2').innerText = '‚è≥';
                document.getElementById('sl3').innerText = '‚è≥';

                setTimeout(async () => {
                    document.getElementById('sl1').innerText = spin[0];
                    document.getElementById('sl2').innerText = spin[1];
                    document.getElementById('sl3').innerText = spin[2];

                    let multiplier = 0;
                    if(spin[0] === spin[1] && spin[1] === spin[2]) multiplier = 15;
                    else if(spin[0] === spin[1] || spin[1] === spin[2] || spin[0] === spin[2]) multiplier = 2;

                    if(multiplier > 0) {
                        const winAmount = betAmount * multiplier;
                        await updateStats(user.balance - betAmount + winAmount, 50);
                        toast(`JACKPOT x${multiplier} ! +${winAmount}‚Ç¨`, "mkPurple");
                    } else {
                        await updateStats(user.balance - betAmount, 10);
                        toast("Rien du tout...", "mkRed");
                    }
                }, 800);
            }

            if(gameType === 'dice') {
                const roll = Math.floor(Math.random() * 6) + 1;
                const diceFaces = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
                document.getElementById('dice-res').innerText = diceFaces[roll-1];
                
                if(roll >= 4) {
                    await updateStats(user.balance + (betAmount * 0.9), 15);
                    toast("Gagn√© !", "mkGreen");
                } else {
                    await updateStats(user.balance - betAmount, 5);
                    toast("Perdu", "mkRed");
                }
            }

            if(gameType === 'rps') {
                const choices = ['pierre', 'feuille', 'ciseaux'];
                const botChoice = choices[Math.floor(Math.random() * 3)];
                
                if(selection === botChoice) {
                    toast(`√âgalit√© ! Le bot a choisi ${botChoice}`, "mkYellow");
                } else if (
                    (selection === 'pierre' && botChoice === 'ciseaux') ||
                    (selection === 'feuille' && botChoice === 'pierre') ||
                    (selection === 'ciseaux' && botChoice === 'feuille')
                ) {
                    await updateStats(user.balance + (betAmount * 2), 30);
                    toast(`BRAVO ! Tu bats ${botChoice}`, "mkGreen");
                } else {
                    await updateStats(user.balance - betAmount, 10);
                    toast(`PERDU ! Le bot a choisi ${botChoice}`, "mkRed");
                }
            }
        }

        // --- CHAT SYSTEM REWORKED ---

        function setChatTab(tab) {
            activeChatTab = tab;
            const tGlobal = document.getElementById('tab-global');
            const tSupport = document.getElementById('tab-support');
            
            if(tab === 'global') {
                tGlobal.className = "flex-1 py-7 text-[10px] font-black uppercase tracking-[0.2em] transition-all border-b-2 border-mkBlue text-mkBlue bg-mkBlue/5";
                tSupport.className = "flex-1 py-7 text-[10px] font-black uppercase tracking-[0.2em] transition-all opacity-40 border-b-2 border-transparent";
            } else {
                tSupport.className = "flex-1 py-7 text-[10px] font-black uppercase tracking-[0.2em] transition-all border-b-2 border-mkRed text-mkRed bg-mkRed/5";
                tGlobal.className = "flex-1 py-7 text-[10px] font-black uppercase tracking-[0.2em] transition-all opacity-40 border-b-2 border-transparent";
            }
            lastMessageTimestamp = null; // Force reload
            loadChatMessages();
        }

        async function loadChatMessages() {
            const container = document.getElementById('chat-flow');
            
            if(activeChatTab === 'global') {
                const { data, error } = await sb.from('messages')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(30);

                if(error || !data) return;
                
                // Anti-flicker: Only update if content changed
                const currentHash = data.length > 0 ? data[0].id : '';
                if(currentHash === lastMessageTimestamp) return;
                lastMessageTimestamp = currentHash;

                container.innerHTML = data.reverse().map(msg => `
                    <div class="flex gap-4 items-start animate-view">
                        <img src="${msg.pfp}" class="w-11 h-11 rounded-2xl object-cover border border-white/5 shadow-lg">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-[7px] font-black bg-mkBlue text-black px-2 py-0.5 rounded uppercase">LVL ${Math.floor((msg.level || 0)/100)}</span>
                                <b class="text-[10px] uppercase text-white/90 font-sync">${msg.username}</b>
                            </div>
                            <div class="bg-white/5 p-4 rounded-3xl rounded-tl-none border border-white/5">
                                <p class="text-[11px] text-white/70 font-medium leading-relaxed">${msg.content}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                // Support Feed for user
                const { data, error } = await sb.from('tickets')
                    .select('*')
                    .eq('username', user.username)
                    .order('created_at', { ascending: false });

                if(error) return;
                if(data.length === lastTicketCount) return;
                lastTicketCount = data.length;

                container.innerHTML = data.map(tk => `
                    <div class="p-6 rounded-3xl bg-mkRed/5 border border-mkRed/10 animate-view">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-[8px] font-black uppercase text-mkRed">Ticket #${tk.id.slice(0,5)}</span>
                            <span class="px-2 py-1 rounded bg-mkRed text-white text-[7px] font-black">${tk.status.toUpperCase()}</span>
                        </div>
                        <p class="text-[10px] font-bold text-white uppercase">${tk.type}</p>
                        <p class="text-[9px] opacity-40 mt-1">Demande enregistr√©e. Un admin vous contactera bient√¥t.</p>
                    </div>
                `).join('') || `<p class="text-center text-[10px] opacity-20 py-10 uppercase font-black tracking-widest">Aucun ticket ouvert</p>`;
            }
            container.scrollTop = container.scrollHeight;
        }

        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const content = input.value.trim();
            if(!user) return toast("Connectez-vous pour parler", "mkRed");
            if(!content) return;

            input.value = "";
            const { error } = await sb.from('messages').insert([{
                username: user.username,
                content: content,
                pfp: user.pfp,
                level: user.xp
            }]);

            if(error) toast("Erreur d'envoi", "mkRed");
            loadChatMessages();
        }

        // --- PROFILE LOGIC ---

        function renderProfileData(u) {
            document.getElementById('p-avatar').src = u.pfp;
            document.getElementById('p-username').innerText = u.username;
            document.getElementById('p-val-cash').innerText = u.balance.toFixed(2) + "‚Ç¨";
            document.getElementById('p-val-xp').innerText = u.xp + " XP";
            
            const controls = document.getElementById('p-controls');
            if(user && u.id === user.id) controls.classList.remove('hidden');
            else controls.classList.add('hidden');
        }

        async function findMember() {
            const search = document.getElementById('search-name').value.trim();
            if(!search) return;
            const { data, error } = await sb.from('profiles').select('*').eq('username', search).maybeSingle();
            if(data) renderProfileData(data);
            else toast("Utilisateur introuvable", "mkRed");
        }

        async function updatePfp() {
            const newUrl = document.getElementById('new-pfp-url').value.trim();
            if(!newUrl) return;
            const { data, error } = await sb.from('profiles').update({ pfp: newUrl }).eq('id', user.id).select().single();
            if(!error) {
                user = data;
                renderProfileData(user);
                document.getElementById('u-pfp').src = user.pfp;
                toast("Avatar mis √† jour", "mkGreen");
            }
        }

        // --- ADMIN MODULE ---

        async function loadAdminPanel() {
            if(user.username.toLowerCase() !== 'admin' && user.role !== 'admin') return;

            // Load Tickets
            const { data: tickets } = await sb.from('tickets').select('*').eq('status', 'open').order('created_at', { ascending: false });
            const tkContainer = document.getElementById('adm-tickets');
            tkContainer.innerHTML = tickets.map(t => `
                <div class="glass p-6 rounded-3xl flex justify-between items-center border-l-4 border-mkRed">
                    <div>
                        <p class="text-[10px] font-black uppercase text-white">${t.type}</p>
                        <p class="text-[9px] font-bold opacity-30 uppercase mt-1">Client: ${t.username}</p>
                    </div>
                    <button onclick="closeTicket('${t.id}')" class="bg-mkRed text-white px-6 py-2 rounded-xl text-[9px] font-black uppercase shadow-lg shadow-mkRed/20 hover:scale-105 transition">Fermer</button>
                </div>
            `).join('') || `<p class="opacity-20 text-[9px] uppercase font-black">Aucun ticket en attente</p>`;

            // Load Users
            const { data: usersList } = await sb.from('profiles').select('*').order('balance', { ascending: false });
            const usContainer = document.getElementById('adm-users');
            usContainer.innerHTML = usersList.map(u => `
                <div class="glass p-6 rounded-3xl space-y-4 border border-white/5">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <img src="${u.pfp}" class="w-8 h-8 rounded-lg object-cover">
                            <b class="text-[10px] uppercase font-sync">${u.username}</b>
                        </div>
                        <span class="text-mkGreen font-black text-xs">${u.balance.toFixed(2)}‚Ç¨</span>
                    </div>
                    <div class="flex gap-2">
                        <input id="adm-mod-${u.id}" type="number" placeholder="Montant" class="bg-black/50 p-2 rounded-xl text-[10px] w-24 outline-none border border-white/5">
                        <button onclick="adminModifyBalance('${u.id}', 1)" class="bg-mkGreen/20 text-mkGreen px-3 rounded-xl text-[8px] font-black">ADD</button>
                        <button onclick="adminModifyBalance('${u.id}', -1)" class="bg-mkRed/20 text-mkRed px-3 rounded-xl text-[8px] font-black">SUB</button>
                        <button onclick="adminToggleTV('${u.id}', ${!u.tv_access})" class="bg-mkAdmin text-white px-3 rounded-xl text-[8px] font-black uppercase">${u.tv_access ? 'Retirer TV' : 'Donner TV'}</button>
                    </div>
                </div>
            `).join('');
        }

        async function adminModifyBalance(targetId, multiplier) {
            const amount = parseFloat(document.getElementById('adm-mod-' + targetId).value);
            if(isNaN(amount)) return;
            const { data: targetUser } = await sb.from('profiles').select('balance').eq('id', targetId).single();
            await sb.from('profiles').update({ balance: targetUser.balance + (amount * multiplier) }).eq('id', targetId);
            toast("Balance mise √† jour", "mkBlue");
            loadAdminPanel();
        }

        async function adminToggleTV(targetId, newState) {
            await sb.from('profiles').update({ tv_access: newState }).eq('id', targetId);
            toast("Acc√®s TV modifi√©", "mkAdmin");
            loadAdminPanel();
        }

        async function closeTicket(id) {
            await sb.from('tickets').update({ status: 'closed' }).eq('id', id);
            toast("Ticket cl√¥tur√©", "mkRed");
            loadAdminPanel();
        }

        // --- UI NAVIGATION & HELPERS ---

        async function loadLeaderboard() {
            const { data } = await sb.from('profiles').select('*').order('balance', { ascending: false }).limit(10);
            const container = document.getElementById('leader-container');
            if(!data) return;

            container.innerHTML = data.map((u, i) => `
                <div class="flex justify-between items-center p-10 border-b border-white/5 hover:bg-white/5 transition-all">
                    <div class="flex items-center gap-10">
                        <span class="text-3xl font-black italic font-sync ${i < 3 ? 'text-mkBlue' : 'opacity-10'}">0${i+1}</span>
                        <img src="${u.pfp}" class="w-16 h-16 rounded-3xl object-cover shadow-2xl border border-white/10">
                        <div>
                            <p class="text-sm font-black uppercase tracking-widest">${u.username}</p>
                            <p class="text-[9px] font-bold text-mkYellow uppercase mt-1">${u.xp} Experience Points</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="text-2xl font-black text-mkGreen tracking-tighter">${u.balance.toFixed(2)}‚Ç¨</span>
                        <p class="text-[8px] opacity-20 font-black uppercase mt-1">Global Balance</p>
                    </div>
                </div>
            `).join('');
        }

        async function openTicket(type) {
            if(!user) return toast("Connectez-vous pour ouvrir un ticket", "mkRed");
            const { error } = await sb.from('tickets').insert([{
                username: user.username,
                type: type,
                status: 'open'
            }]);
            if(!error) toast("Votre demande a √©t√© envoy√©e au staff !", "mkGreen");
        }

        async function unlockTV() {
            const input = document.getElementById('tv-code').value.trim();
            if(input === "ACCES-BUYED-0001" || user.tv_access) {
                const { error } = await sb.from('profiles').update({ tv_access: true }).eq('id', user.id);
                user.tv_access = true;
                document.getElementById('tv-card').innerHTML = `
                    <div class="w-full text-center py-10 animate-view">
                        <h3 class="text-5xl font-black text-mkGreen uppercase italic mb-4 font-sync">Access Granted</h3>
                        <p class="text-xs opacity-50 uppercase tracking-widest">Bienvenue dans le MK Cinema VIP. Profitez de votre contenu.</p>
                        <button class="mt-8 bg-white text-black px-12 py-4 rounded-2xl font-black text-[10px] uppercase">Lancer le Player 4K</button>
                    </div>
                `;
                toast("MK CINEMA D√âBLOQU√â", "mkGreen");
            } else {
                toast("Code invalide ou expir√©", "mkRed");
            }
        }

        function showSection(id) {
            document.querySelectorAll('.content-wrapper > section').forEach(s => s.classList.add('hidden'));
            document.getElementById('s-' + id).classList.remove('hidden');
            
            // Tab active state
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active', 'opacity-100'));
            // Sync triggers
            if(id === 'leaderboard') loadLeaderboard();
            if(id === 'admin') loadAdminPanel();
            if(id === 'profile') renderProfileData(user);
            window.scrollTo(0,0);
        }

        function setMode(m) {
            currentMode = m;
            document.getElementById('m-cash').className = m === 'cash' ? 'px-6 py-2.5 rounded-xl text-[10px] font-black bg-mkGreen text-black shadow-2xl transition-all' : 'px-6 py-2.5 rounded-xl text-[10px] font-black opacity-30 text-white transition-all';
            document.getElementById('m-xp').className = m === 'xp' ? 'px-6 py-2.5 rounded-xl text-[10px] font-black bg-mkYellow text-black shadow-2xl transition-all' : 'px-6 py-2.5 rounded-xl text-[10px] font-black opacity-30 text-white transition-all';
            syncGlobalDisplay();
        }

        function openModal(id) { 
            document.getElementById(id).classList.remove('hidden'); 
            document.body.style.overflow = 'hidden';
        }

        function closeModal(id) { 
            document.getElementById(id).classList.add('hidden'); 
            document.body.style.overflow = 'auto';
        }

        function logout() {
            localStorage.removeItem('mk_session_v72_platinum');
            location.reload();
        }

        // --- BOOTSTRAP ---
        window.onload = () => {
            const saved = localStorage.getItem('mk_session_v72_platinum');
            if(saved) {
                user = JSON.parse(saved);
                initApp();
            }
            // Auto-scroll chat to bottom on first load
            const flow = document.getElementById('chat-flow');
            flow.scrollTop = flow.scrollHeight;
        };

        // --- FILTER FOR ADMIN SEARCH ---
        function filterAdminUsers() {
            const val = document.getElementById('adm-search').value.toLowerCase();
            const cards = document.querySelectorAll('#adm-users > div');
            cards.forEach(c => {
                const name = c.querySelector('b').innerText.toLowerCase();
                c.style.display = name.includes(val) ? 'block' : 'none';
            });
        }
    </script>
</body>
</html>
