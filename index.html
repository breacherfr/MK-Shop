<!DOCTYPE html>
<html lang="fr" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MK SHOP - V39 ULTIMATE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Montserrat', 'sans-serif'] },
                    colors: { mkBlue: '#00d2ff', mkRed: '#ff4b5c', mkPurple: '#a363ff', mkYellow: '#fbbf24' }
                }
            }
        }
    </script>
    <style>
        .card-shadow { box-shadow: 0 20px 50px rgba(0,0,0,0.08); }
        .netflix-bg { background: #050505; }
        .btn-black { background: #111827; color: white; transition: all 0.3s; cursor: pointer; border-radius: 99px; }
        .btn-black:hover { background: #1f2937; transform: translateY(-2px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .chat-bubble-me { background: #111827; color: white; border-radius: 18px 18px 0 18px; padding: 10px 15px; }
        .chat-bubble-other { background: #f1f5f9; border-radius: 18px 18px 18px 0; padding: 10px 15px; }
        .dark .chat-bubble-other { background: #334155; color: white; }
    </style>
</head>
<body class="font-sans text-slate-800 bg-[#f8fafc] dark:bg-[#0f172a] dark:text-white transition-colors duration-300">

    <nav class="bg-white dark:bg-[#1e293b] border-b border-gray-100 dark:border-white/5 px-8 py-4 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-2 cursor-pointer" onclick="window.location.reload()">
            <img src="https://cdn-icons-png.flaticon.com/512/3081/3081840.png" class="w-9 h-9">
            <h1 class="text-2xl font-black italic text-slate-900 dark:text-white uppercase">MK <span class="text-mkBlue">SHOP</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <button onclick="startChat('Support')" class="bg-slate-100 dark:bg-white/5 px-4 py-2 rounded-full text-[10px] font-bold uppercase">üéß Support</button>
            <button onclick="toggleTheme()" class="p-2.5 bg-slate-100 dark:bg-slate-800 rounded-full">üåô</button>
            <div id="user-display" class="hidden flex items-center gap-3">
                <span id="user-name" class="text-xs font-bold bg-mkBlue/10 text-mkBlue px-4 py-2 rounded-full border border-mkBlue/20"></span>
                <button onclick="logout()" class="text-[10px] font-black text-mkRed uppercase">D√©connexion</button>
            </div>
            <div id="auth-btns">
                <button onclick="openModal('auth-modal')" class="bg-mkBlue text-white text-xs font-bold px-6 py-3 rounded-full uppercase">Connexion</button>
            </div>
        </div>
    </nav>

    <div id="main-shop">
        <header class="text-center py-16">
            <h2 class="text-6xl font-black italic uppercase mb-2">Catalogue MK</h2>
            <p class="text-mkBlue font-bold text-xs tracking-widest uppercase">Version Cloud Int√©grale</p>
        </header>

        <main class="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 pb-20">
            <div class="bg-white dark:bg-[#1e293b] p-8 rounded-[2rem] card-shadow border-t-8 border-mkBlue">
                <div class="text-5xl mb-6">üéÆ</div>
                <h3 class="text-2xl font-black uppercase italic mb-2">Comptes Roblox</h3>
                <p class="text-xs text-slate-500 mb-6 font-medium">‚Ä¢ Robux ‚Ä¢ Blox Fruits ‚Ä¢ Da Hood</p>
                <button onclick="startChat('Achat Roblox')" class="btn-black w-full py-4 text-[10px] font-black uppercase italic">Acheter</button>
            </div>

            <div class="bg-white dark:bg-[#1e293b] p-8 rounded-[2rem] card-shadow border-t-8 border-mkRed">
                <div class="text-5xl mb-6">üéØ</div>
                <h3 class="text-2xl font-black uppercase italic mb-2">Roblox Cheat</h3>
                <p class="text-xs text-slate-500 mb-6 font-medium">‚Ä¢ Executors PC/Mobile ‚Ä¢ Scripts Priv√©s</p>
                <button onclick="startChat('Achat Cheat')" class="btn-black w-full py-4 text-[10px] font-black uppercase italic">Voir Tarifs</button>
            </div>

            <div class="bg-white dark:bg-[#1e293b] p-8 rounded-[2rem] card-shadow border-t-8 border-cyan-400">
                <div class="text-5xl mb-6">üì∫</div>
                <h3 class="text-2xl font-black uppercase italic mb-2">MK Stream TV</h3>
                <input id="tv-code-field" type="text" placeholder="CODE ACHET√â" class="w-full bg-slate-50 dark:bg-black/20 p-4 rounded-xl mb-4 outline-none text-xs font-bold uppercase">
                <button onclick="checkTvCode()" class="btn-black w-full py-4 text-[10px] font-black uppercase italic">Acc√©der</button>
            </div>

            <div class="bg-white dark:bg-[#1e293b] p-8 rounded-[2rem] card-shadow border-t-8 border-mkYellow">
                <div class="text-5xl mb-6">‚≠ê</div>
                <h3 class="text-2xl font-black uppercase italic mb-2">Premium Shop</h3>
                <p class="text-xs text-slate-500 mb-6 font-medium">‚Ä¢ Netflix ‚Ä¢ Spotify ‚Ä¢ Disney+ (√Ä vie)</p>
                <button onclick="startChat('Achat Premium')" class="btn-black w-full py-4 text-[10px] font-black uppercase italic">Commander</button>
            </div>

            <div class="bg-white dark:bg-[#1e293b] p-8 rounded-[2rem] card-shadow border-t-8 border-mkPurple lg:col-span-2 flex items-center gap-6">
                <div class="text-6xl">‚ú®</div>
                <div class="flex-1">
                    <h3 class="text-2xl font-black uppercase italic">Demande Sp√©ciale</h3>
                    <p class="text-xs text-slate-500 font-medium">Besoin d'autre chose ? Contactez-nous !</p>
                </div>
                <button onclick="startChat('Demande Perso')" class="btn-black px-10 py-4 text-[10px] font-black uppercase italic">Contacter</button>
            </div>
        </main>
    </div>

    <div id="tv-section" class="hidden fixed inset-0 z-[60] netflix-bg overflow-y-auto">
        <nav class="p-6 flex justify-between items-center bg-black/95 sticky top-0 border-b border-white/5">
            <h2 class="text-2xl font-black italic text-mkBlue uppercase">MK <span class="text-white">STREAM</span></h2>
            <button onclick="closeTv()" class="bg-mkRed text-white px-6 py-2 rounded-full text-[10px] font-bold uppercase">Quitter</button>
        </nav>
        <div id="catalog-view" class="p-8 space-y-16">
            <section>
                <h3 class="text-xl font-black text-white mb-6 uppercase border-l-4 border-mkBlue pl-4 italic">Mangas Shonen</h3>
                <div id="row-shonen" class="flex gap-4 overflow-x-auto no-scrollbar pb-4"></div>
            </section>
            <section>
                <h3 class="text-xl font-black text-white mb-6 uppercase border-l-4 border-yellow-500 pl-4 italic">Dessins Anim√©s</h3>
                <div id="row-cartoons" class="flex gap-4 overflow-x-auto no-scrollbar pb-4"></div>
            </section>
        </div>
        <div id="episode-view" class="hidden p-8">
            <button onclick="backToCatalog()" class="text-mkBlue font-bold text-xs mb-8 uppercase">‚Üê Retour au catalogue</button>
            <h2 id="ep-title" class="text-4xl font-black text-white uppercase italic mb-8"></h2>
            <div id="ep-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6"></div>
        </div>
    </div>

    <div id="player-overlay" class="hidden fixed inset-0 z-[100] bg-black flex flex-col">
        <div class="p-4 flex justify-between bg-black text-white"><span class="text-[10px] font-black uppercase">Lecture MK HD</span><button onclick="stopVideo()">‚úï</button></div>
        <iframe id="ifr-player" class="flex-1 w-full h-full" allow="autoplay; fullscreen" frameborder="0"></iframe>
    </div>

    <div id="chat-modal" class="hidden fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white dark:bg-[#1e293b] w-full max-w-lg h-[550px] rounded-[2.5rem] flex flex-col overflow-hidden">
            <div class="bg-slate-900 p-5 text-white flex justify-between items-center font-black uppercase text-[10px]">
                <span>Support MK SHOP</span> <button onclick="closeModal('chat-modal')">‚úï</button>
            </div>
            <div id="chat-body" class="flex-1 p-6 overflow-y-auto space-y-4 bg-slate-50 dark:bg-[#0f172a]"></div>
            <div class="p-4 flex gap-2 border-t dark:border-white/5">
                <input id="chat-input" type="text" placeholder="√âcrire..." class="flex-1 bg-slate-100 dark:bg-slate-800 rounded-full px-6 outline-none text-xs">
                <button onclick="sendMessage()" class="bg-mkBlue text-white w-10 h-10 rounded-full font-black">‚û§</button>
            </div>
        </div>
    </div>

    <div id="auth-modal" class="hidden fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-white dark:bg-[#1e293b] p-10 rounded-[2.5rem] w-full max-w-sm text-center">
            <h3 class="text-2xl font-black mb-8 italic uppercase">Compte Cloud</h3>
            <input id="in-user" type="text" placeholder="Pseudo" class="w-full bg-slate-50 dark:bg-black/40 p-4 rounded-xl mb-4 outline-none font-bold">
            <input id="in-pass" type="password" placeholder="Mot de passe" class="w-full bg-slate-50 dark:bg-black/40 p-4 rounded-xl mb-6 outline-none font-bold">
            <button onclick="handleAuth()" class="w-full bg-mkBlue text-white font-black py-4 rounded-full uppercase italic">Valider</button>
        </div>
    </div>

    <div id="admin-auth-modal" class="hidden fixed inset-0 z-[110] bg-black/90 flex items-center justify-center">
        <div class="bg-[#1e293b] p-8 rounded-[2rem] text-center w-full max-w-xs">
            <h3 class="text-xl font-black text-mkRed mb-6 uppercase italic">Acc√®s Master</h3>
            <input id="admin-pass-input" type="password" placeholder="Code" class="w-full bg-black/40 p-4 rounded-xl mb-4 text-center text-white outline-none">
            <button onclick="verifyAdmin()" class="w-full bg-mkRed text-white py-4 rounded-xl font-black uppercase italic">Ouvrir</button>
        </div>
    </div>

    <div id="admin-panel" class="hidden fixed inset-0 z-[120] bg-[#0f172a] text-white p-8 overflow-y-auto">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-8 border-b border-white/10 pb-4">
                <h2 class="text-xl font-black italic text-mkBlue uppercase">MK CLOUD MANAGER</h2>
                <button onclick="closeModal('admin-panel')" class="bg-mkRed px-6 py-2 rounded-full text-[10px] font-bold">FERMER</button>
            </div>
            <div id="admin-user-list" class="space-y-4"></div>
        </div>
    </div>

    <script>
        // CONFIG SUPABASE (COLLE TA CL√â ICI)
        const SB_URL = "https://eeiuxfcgysrarctokuyg.supabase.co";
        const SB_KEY = "sb_publishable_..."; // <--- TA CL√â ICI
        const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

        const ADMIN_PASS = "admin123";
        const TV_CODE = "ACCES-ACHETER-0001";

        // CATALOGUE TRI√â
        const content = [
            { id: 0, cat: "shonen", title: "One Piece", poster: "https://image.animationdigitalnetwork.fr/license/onepiece/arc5/web/affiche_350x500.jpg", episodes: [{t:"√âpisode 1", u:"BxuMkEvNagQ"}] },
            { id: 1, cat: "shonen", title: "Naruto", poster: "https://zqwqz.org/img/naruto-classic-1622930404.jpg", episodes: Array.from({length:10}, (_, i) => ({t:`√âpisode ${i+1}`, u:"FoVvpkMlTqM"})) },
            { id: 2, cat: "shonen", title: "Dragon Ball Z", poster: "https://fr.web.img6.acsta.net/pictures/19/04/18/14/51/1899178.jpg", episodes: [{t:"√âpisode 1", u:"BxuMkEvNagQ"}] },
            { id: 3, cat: "cartoons", title: "Bob l'√©ponge", poster: "https://www.topkool.com/fr/wp-content/uploads/2013/04/bob-l-eponge-022.jpg", episodes: Array.from({length:10}, (_, i) => ({t:`√âpisode ${i+1}`, u:"dhJtWThO5kw"})) },
            { id: 4, cat: "cartoons", title: "Le Monde de Gumball", poster: "https://quotecatalog.imgix.net/assets/title-sbTftntUdiZ67GmtaPYjAjyX/original.jpg?w=400&h=600&fit=crop", episodes: [{t:"√âpisode 1", u:"FoVvpkMlTqM"}] }
        ];

        let user = JSON.parse(localStorage.getItem('mk_session')) || null;

        window.onload = () => {
            if(user) { applySession(); syncLoop(); }
            renderCatalog();
        };

        // AUTH & SYNC
        async function handleAuth() {
            const u = document.getElementById('in-user').value.trim();
            const p = document.getElementById('in-pass').value;
            if(!u || !p) return;

            const { data: profile } = await supabaseClient.from('profiles').select('*').eq('username', u).single();

            if (profile) {
                if (profile.password === p) {
                    user = { u: profile.username, p: profile.password, hasTv: profile.has_tv, messages: profile.messages };
                    saveSession();
                    location.reload();
                } else alert("Erreur MDP");
            } else {
                await supabaseClient.from('profiles').insert([{ username: u, password: p, has_tv: false, messages: [] }]);
                alert("Compte cr√©√© !");
            }
        }

        async function syncLoop() {
            const { data } = await supabaseClient.from('profiles').select('messages, has_tv').eq('username', user.u).single();
            if(data) {
                user.messages = data.messages;
                user.hasTv = data.has_tv;
                if(!document.getElementById('chat-modal').classList.contains('hidden')) renderMessages();
            }
            setTimeout(syncLoop, 5000);
        }

        // UI
        function renderCatalog() {
            ['shonen', 'cartoons'].forEach(cat => {
                document.getElementById(`row-${cat}`).innerHTML = content.filter(x => x.cat === cat).map(item => `
                    <div onclick="showEpisodes(${item.id})" class="min-w-[150px] h-[220px] rounded-2xl bg-cover bg-center cursor-pointer hover:scale-105 transition" style="background-image: url('${item.poster}')"></div>
                `).join('');
            });
        }

        function showEpisodes(id) {
            const item = content.find(x => x.id === id);
            document.getElementById('catalog-view').classList.add('hidden');
            document.getElementById('episode-view').classList.remove('hidden');
            document.getElementById('ep-title').innerText = item.title;
            document.getElementById('ep-list').innerHTML = item.episodes.map(ep => `
                <div onclick="playVideo('${ep.u}')" class="bg-white/5 p-2 rounded-xl cursor-pointer">
                    <img src="https://img.youtube.com/vi/${ep.u}/mqdefault.jpg" class="rounded-lg w-full mb-2">
                    <span class="text-[9px] font-bold text-white uppercase italic">${ep.t}</span>
                </div>
            `).join('');
        }

        // FONCTIONS G√âN√âRALES
        function checkTvCode() { if(document.getElementById('tv-code-field').value === TV_CODE || (user && user.hasTv)) openModal('tv-section'); else alert("Code n√©cessaire."); }
        function playVideo(u) { document.getElementById('player-overlay').classList.remove('hidden'); document.getElementById('ifr-player').src = `https://www.youtube.com/embed/${u}?autoplay=1`; }
        function stopVideo() { document.getElementById('player-overlay').classList.add('hidden'); document.getElementById('ifr-player').src = ""; }
        function backToCatalog() { document.getElementById('episode-view').classList.add('hidden'); document.getElementById('catalog-view').classList.remove('hidden'); }
        function closeTv() { closeModal('tv-section'); }
        function startChat() { if(!user) return openModal('auth-modal'); openModal('chat-modal'); renderMessages(); }
        function renderMessages() {
            document.getElementById('chat-body').innerHTML = user.messages.map(m => `
                <div class="flex ${m.from === 'me' ? 'justify-end' : 'justify-start'}">
                    <div class="${m.from === 'me' ? 'chat-bubble-me' : 'chat-bubble-other'} text-[10px] font-bold">${m.txt}</div>
                </div>
            `).join('');
        }
        async function sendMessage() {
            const inp = document.getElementById('chat-input'); if(!inp.value) return;
            user.messages.push({ from: 'me', txt: inp.value });
            await supabaseClient.from('profiles').update({ messages: user.messages }).eq('username', user.u);
            inp.value = ""; renderMessages();
        }
        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function toggleTheme() { document.documentElement.classList.toggle('dark'); }
        function saveSession() { localStorage.setItem('mk_session', JSON.stringify(user)); }
        function applySession() {
            document.getElementById('auth-btns').classList.add('hidden');
            document.getElementById('user-display').classList.remove('hidden');
            document.getElementById('user-name').innerText = user.u.toUpperCase();
        }
        function logout() { localStorage.removeItem('mk_session'); location.reload(); }

        // ADMIN
        async function verifyAdmin() {
            if(document.getElementById('admin-pass-input').value === ADMIN_PASS) {
                closeModal('admin-auth-modal'); openModal('admin-panel');
                const { data } = await supabaseClient.from('profiles').select('*');
                document.getElementById('admin-user-list').innerHTML = data.map((u, i) => `
                    <div class="bg-white/5 p-5 rounded-2xl flex flex-col gap-3">
                        <div class="flex justify-between items-center">
                            <span class="font-black text-mkBlue uppercase text-sm">${u.username}</span>
                            <button onclick="adminToggleTv('${u.username}', ${u.has_tv})" class="bg-slate-700 px-4 py-1 rounded text-[9px]">${u.has_tv ? 'ACC√àS TV OK' : 'PAS DE TV'}</button>
                        </div>
                        <div class="flex gap-2">
                            <input id="admin-rep-${i}" type="text" placeholder="R√©pondre..." class="flex-1 bg-black/40 p-2 rounded text-xs outline-none">
                            <button onclick="adminReply('${u.username}', ${i})" class="bg-mkYellow text-black px-4 rounded font-bold text-[10px]">OK</button>
                        </div>
                    </div>
                `).join('');
            }
        }
        async function adminToggleTv(target, current) {
            await supabaseClient.from('profiles').update({ has_tv: !current }).eq('username', target);
            verifyAdmin();
        }
        async function adminReply(target, i) {
            const txt = document.getElementById(`admin-rep-${i}`).value;
            const { data } = await supabaseClient.from('profiles').select('messages').eq('username', target).single();
            let msg = data.messages; msg.push({ from: 'support', txt: txt });
            await supabaseClient.from('profiles').update({ messages: msg }).eq('username', target);
            alert("R√©ponse envoy√©e");
        }
    </script>
</body>
</html>
